!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Hls=a()}}(function(){var a;return function d(a,b,c){function e(g,h){var i,j,k;if(!b[g]){if(!a[g]){if(i="function"==typeof require&&require,!h&&i)return i(g,!0);if(f)return f(g,!0);throw j=new Error("Cannot find module '"+g+"'"),j.code="MODULE_NOT_FOUND",j}k=b[g]={exports:{}},a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,d,a,b,c)}return b[g].exports}var g,f="function"==typeof require&&require;for(g=0;g<c.length;g++)e(c[g]);return e}({1:[function(a,b){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j,k;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length))throw b=arguments[1],b instanceof Error?b:(k=new Error('Uncaught, unspecified "error" event. ('+b+")"),k.context=b,k);if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function d(){this.removeListener(a,d),c||(c=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var c=!1;return d.listener=b,this.on(a,d),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],2:[function(b,c,d){!function(b){var e=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,f=/^([^\/;?#]*)(.*)$/,g=/(?:\/|^)\.(?=\/)/g,h=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,i={buildAbsoluteURL:function(a,b,c){var d,e,g,h,j,k,l;if(c=c||{},a=a.trim(),b=b.trim(),!b){if(!c.alwaysNormalize)return a;if(d=this.parseURL(a),!g)throw new Error("Error trying to parse base URL.");return d.path=i.normalizePath(d.path),i.buildURLFromParts(d)}if(e=this.parseURL(b),!e)throw new Error("Error trying to parse relative URL.");if(e.scheme)return c.alwaysNormalize?(e.path=i.normalizePath(e.path),i.buildURLFromParts(e)):b;if(g=this.parseURL(a),!g)throw new Error("Error trying to parse base URL.");return!g.netLoc&&g.path&&"/"!==g.path[0]&&(h=f.exec(g.path),g.netLoc=h[1],g.path=h[2]),g.netLoc&&!g.path&&(g.path="/"),j={scheme:g.scheme,netLoc:e.netLoc,path:null,params:e.params,query:e.query,fragment:e.fragment},e.netLoc||(j.netLoc=g.netLoc,"/"!==e.path[0]&&(e.path?(k=g.path,l=k.substring(0,k.lastIndexOf("/")+1)+e.path,j.path=i.normalizePath(l)):(j.path=g.path,e.params||(j.params=g.params,e.query||(j.query=g.query))))),null===j.path&&(j.path=c.alwaysNormalize?i.normalizePath(e.path):e.path),i.buildURLFromParts(j)},parseURL:function(a){var b=e.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(g,"");a.length!==(a=a.replace(h,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};"object"==typeof d&&"object"==typeof c?c.exports=i:"function"==typeof a&&a.amd?a([],function(){return i}):"object"==typeof d?d["URLToolkit"]=i:b["URLToolkit"]=i}(this)},{}],3:[function(a,b){var d=arguments[3],e=arguments[4],f=arguments[5],g=JSON.stringify;b.exports=function(a,b){function q(a){var b,c;p[a]=!0;for(b in e[a][1])c=e[a][1][b],p[c]||q(c)}var c,i,j,k,l,m,n,o,p,r,s,t,u,v,h=Object.keys(f);for(i=0,j=h.length;j>i;i++)if(k=h[i],l=f[k].exports,l===a||l&&l.default===a){c=k;break}if(!c){for(c=Math.floor(Math.pow(16,8)*Math.random()).toString(16),m={},i=0,j=h.length;j>i;i++)k=h[i],m[k]=k;e[c]=[Function(["require","module","exports"],"("+a+")(self)"),m]}return n=Math.floor(Math.pow(16,8)*Math.random()).toString(16),o={},o[c]=c,e[n]=[Function(["require"],"var f = require("+g(c)+");"+"(f.default ? f.default : f)(self);"),o],p={},q(n),r="("+d+")({"+Object.keys(p).map(function(a){return g(a)+":["+e[a][0]+","+g(e[a][1])+"]"}).join(",")+"},{},["+g(n)+"])",s=window.URL||window.webkitURL||window.mozURL||window.msURL,t=new Blob([r],{type:"text/javascript"}),b&&b.bare?t:(u=s.createObjectURL(t),v=new Worker(u),v.objectURL=u,v)}},{}],4:[function(a,b,c){"use strict";function z(a){return a&&a.__esModule?a:{"default":a}}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;Object.defineProperty(c,"__esModule",{value:!0}),c.hlsDefaultConfig=void 0,d=a(5),e=z(d),f=a(8),g=z(f),h=a(9),i=z(h),j=a(10),k=z(j),l=a(59),m=z(l),n=a(7),o=z(n),p=a(6),q=z(p),r=a(50),s=z(r),t=a(16),u=z(t),v=a(15),w=z(v),x=a(14),y=z(x),c.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:e.default,bufferController:g.default,capLevelController:i.default,fpsController:k.default,audioStreamController:q.default,audioTrackController:o.default,subtitleStreamController:y.default,subtitleTrackController:w.default,timelineController:u.default,cueHandler:s.default,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{10:10,14:14,15:15,16:16,5:5,50:50,59:59,6:6,7:7,8:8,9:9}],5:[function(a,b,c){"use strict";function o(a){return a&&a.__esModule?a:{"default":a}}function p(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function r(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,j,k,l,m,n,s;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=o(e),g=a(34),h=o(g),i=a(37),j=o(i),k=a(33),l=a(54),m=a(52),n=o(m),s=function(a){function b(a){p(this,b);var c=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.FRAG_LOADING,f.default.FRAG_LOADED,f.default.FRAG_BUFFERED,f.default.ERROR));return c.lastLoadedFragLevel=0,c._nextAutoLevel=-1,c.hls=a,c.timer=null,c._bwEstimator=null,c.onCheck=c._abandonRulesCheck.bind(c),c}return r(b,a),d(b,[{key:"destroy",value:function(){this.clearTimer(),h.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var c,d,e,f,g,h,b=a.frag;"main"===b.type&&(this.timer||(this.timer=setInterval(this.onCheck,100)),this._bwEstimator||(c=this.hls,d=a.frag.level,e=c.levels[d].details.live,f=c.config,g=void 0,h=void 0,e?(g=f.abrEwmaFastLive,h=f.abrEwmaSlowLive):(g=f.abrEwmaFastVoD,h=f.abrEwmaSlowVoD),this._bwEstimator=new n.default(c,h,g,f.abrEwmaDefaultEstimate)),this.fragCurrent=b)}},{key:"_abandonRulesCheck",value:function(){var g,h,i,k,m,n,o,p,q,r,s,t,u,v,a=this.hls,b=a.media,c=this.fragCurrent,d=c.loader,e=a.minAutoLevel;if(!d||d.stats&&d.stats.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void 0;if(g=d.stats,b&&g&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level&&(h=performance.now()-g.trequest,i=Math.abs(b.playbackRate),h>500*c.duration/i&&(k=a.levels,m=Math.max(1,g.bw?g.bw/8:1e3*g.loaded/h),n=k[c.level],o=n.realBitrate?Math.max(n.realBitrate,n.bitrate):n.bitrate,p=g.total?g.total:Math.max(g.loaded,Math.round(c.duration*o/8)),q=b.currentTime,r=(p-g.loaded)/m,s=(j.default.bufferInfo(b,q,a.config.maxBufferHole).end-q)/i,s<2*c.duration/i&&r>s))){for(t=void 0,u=void 0,u=c.level-1;u>e&&(v=k[u].realBitrate?Math.max(k[u].realBitrate,k[u].bitrate):k[u].bitrate,t=c.duration*v/(6.4*m),!(s>t));u--);r>t&&(l.logger.warn("loading too slow, abort fragment loading and switch to level "+u+":fragLoadedDelay["+u+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+t.toFixed(1)+"<"+r.toFixed(1)+":"+s.toFixed(1)),a.nextLoadLevel=u,this._bwEstimator.sample(h,g.loaded),d.abort(),this.clearTimer(),a.trigger(f.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:g}))}}},{key:"onFragLoaded",value:function(a){var c,d,e,f,b=a.frag;"main"!==b.type||isNaN(b.sn)||(this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(c=this.hls.levels[b.level],d=(c.loaded?c.loaded.bytes:0)+a.stats.loaded,e=(c.loaded?c.loaded.duration:0)+a.frag.duration,c.loaded={bytes:d,duration:e},c.realBitrate=Math.round(8*d/e)),a.frag.bitrateTest&&(f=a.stats,f.tparsed=f.tbuffered=f.tload,this.onFragBuffered(a)))}},{key:"onFragBuffered",value:function(a){var d,b=a.stats,c=a.frag;b.aborted===!0||1!==c.loadCounter||"main"!==c.type||isNaN(c.sn)||c.bitrateTest&&b.tload!==b.tbuffered||(d=b.tparsed-b.trequest,l.logger.log("latency/loading/parsing/append/kbps:"+Math.round(b.tfirst-b.trequest)+"/"+Math.round(b.tload-b.tfirst)+"/"+Math.round(b.tparsed-b.tload)+"/"+Math.round(b.tbuffered-b.tparsed)+"/"+Math.round(8*b.loaded/(b.tbuffered-b.trequest))),this._bwEstimator.sample(d,b.loaded),b.bwEstimate=this._bwEstimator.getEstimate(),this.bitrateTestDelay=c.bitrateTest?d/1e3:0)}},{key:"onError",value:function(a){switch(a.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){clearInterval(this.timer),this.timer=null}},{key:"_findBestLevel",value:function(a,b,c,d,e,f,g,h,i){var j,k,m,n,o,p,q,r;for(j=e;j>=d;j--)if(k=i[j],m=k.details,n=m?m.totalduration/m.fragments.length:b,o=m?m.live:!1,p=void 0,p=a>=j?g*c:h*c,q=i[j].realBitrate?Math.max(i[j].realBitrate,i[j].bitrate):i[j].bitrate,r=q*n/p,l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+j+"/"+Math.round(p)+"/"+q+"/"+n+"/"+f+"/"+r),p>q&&(!r||o&&!this.bitrateTestDelay||f>r))return j;return-1}},{key:"nextAutoLevel",get:function(){var c,a=this._nextAutoLevel,b=this._bwEstimator;return-1===a||b&&b.canEstimate()?(c=this._nextABRAutoLevel,-1!==a&&(c=Math.min(a,c)),c):a},set:function(a){this._nextAutoLevel=a}},{key:"_nextABRAutoLevel",get:function(){var p,q,r,s,t,a=this.hls,b=a.maxAutoLevel,c=a.levels,d=a.config,e=a.minAutoLevel,f=a.media,g=this.lastLoadedFragLevel,h=this.fragCurrent?this.fragCurrent.duration:0,i=f?f.currentTime:0,k=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,m=this._bwEstimator?this._bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,n=(j.default.bufferInfo(f,i,d.maxBufferHole).end-i)/k,o=this._findBestLevel(g,h,m,e,b,n,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);return o>=0?o:(l.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering"),p=h?Math.min(h,d.maxStarvationDelay):d.maxStarvationDelay,q=d.abrBandWidthFactor,r=d.abrBandWidthUpFactor,0===n&&(s=this.bitrateTestDelay,s&&(t=h?Math.min(h,d.maxLoadingDelay):d.maxLoadingDelay,p=t-s,l.logger.trace("bitrate test took "+Math.round(1e3*s)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),q=r=1)),o=this._findBestLevel(g,h,m,e,b,n+p,q,r,c),Math.max(o,0))}}]),b}(h.default),c.default=s},{33:33,34:34,35:35,37:37,52:52,54:54}],6:[function(a,b,c){"use strict";function v(a){return a&&a.__esModule?a:{"default":a}}function w(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function x(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function y(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,z,A;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(48),f=v(e),g=a(37),h=v(g),i=a(25),j=v(i),k=a(35),l=v(k),m=a(34),n=v(m),o=a(38),p=v(o),q=a(55),r=v(q),s=a(33),t=a(54),u=a(51),z={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},A=function(a){function b(a){w(this,b);var c=x(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.AUDIO_TRACKS_UPDATED,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_LOADED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED,l.default.INIT_PTS_FOUND));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c._state=z.STOPPED,c.ontick=c.tick.bind(c),c.initPTS=[],c.waitingFragment=null,c.videoTrackCC=null,c}return y(b,a),d(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),n.default.prototype.destroy.call(this),this.state=z.STOPPED}},{key:"onInitPtsFound",value:function(a){var b=a.id,c=a.frag.cc,d=a.initPTS;"main"===b&&(this.initPTS[c]=d,this.videoTrackCC=c,t.logger.log("InitPTS for cc:"+c+" found from video track:"+d),this.state===z.WAITING_INIT_PTS&&this.tick())}},{key:"startLoad",value:function(a){if(this.tracks){var b=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,b>0&&-1===a?(t.logger.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=z.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=z.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=z.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=z.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var a,b,c,g,i,j,k,m,n,o,p,q,r,v,w,x,y,A,B,C,D,E,F,G,H,I,J,K,L,d=this.hls,e=d.config;switch(this.state){case z.ERROR:case z.PAUSED:case z.BUFFER_FLUSHING:break;case z.STARTING:this.state=z.WAITING_TRACK,this.loadedmetadata=!1;break;case z.IDLE:if(g=this.tracks,!g)break;if(!this.media&&(this.startFragRequested||!e.startFragPrefetch))break;if(this.loadedmetadata)a=this.media.currentTime;else if(a=this.nextLoadPosition,void 0===a)break;if(i=this.mediaBuffer?this.mediaBuffer:this.media,j=h.default.bufferInfo(i,a,e.maxBufferHole),k=j.len,m=j.end,n=this.fragPrevious,o=e.maxMaxBufferLength,p=this.audioSwitch,q=this.trackId,(o>k||p)&&q<g.length){if(c=g[q].details,"undefined"==typeof c){this.state=z.WAITING_TRACK;break}if(!p&&!c.live&&n&&n.sn===c.endSN&&(!this.media.seeking||this.media.duration-m<n.duration/2)){this.hls.trigger(l.default.BUFFER_EOS,{type:"audio"}),this.state=z.ENDED;break}if(r=c.fragments,v=r.length,w=r[0].start,x=r[v-1].start+r[v-1].duration,y=void 0,p)if(c.live&&!c.PTSKnown)t.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),m=0;else if(m=a,c.PTSKnown&&w>a){if(!(j.end>w||j.nextStart))return;t.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=w+.05}if(c.initSegment&&!c.initSegment.data)y=c.initSegment;else if(w>=m){if(y=r[0],null!==this.videoTrackCC&&y.cc!==this.videoTrackCC&&(y=u.findFragWithCC(r,this.videoTrackCC)),c.live&&y.loadIdx&&y.loadIdx===this.fragLoadIdx)return A=j.nextStart?j.nextStart:w,t.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(A+.05)),this.media.currentTime=A+.05,void 0}else B=void 0,C=e.maxFragLookUpTolerance,D=n?r[n.sn-r[0].sn+1]:void 0,E=function(a){var b=Math.min(C,a.duration);return a.start+a.duration-b<=m?1:a.start-b>m&&a.start?-1:0},x>m?(m>x-C&&(C=0),B=D&&!E(D)?D:f.default.search(r,E)):B=r[v-1],B&&(y=B,w=B.start,n&&y.level===n.level&&y.sn===n.sn&&(y.sn<c.endSN?(y=r[y.sn+1-c.startSN],t.logger.log("SN just loaded, load next one: "+y.sn)):y=null));if(y)if(y.decryptdata&&null!=y.decryptdata.uri&&null==y.decryptdata.key)t.logger.log("Loading key for "+y.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+q),this.state=z.KEY_LOADING,d.trigger(l.default.KEY_LOADING,{frag:y});else{if(t.logger.log("Loading "+y.sn+", cc: "+y.cc+" of ["+c.startSN+" ,"+c.endSN+"],track "+q+", currentTime:"+a+",bufferEnd:"+m.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,y.loadCounter){if(y.loadCounter++,F=e.fragLoadingLoopThreshold,y.loadCounter>F&&Math.abs(this.fragLoadIdx-y.loadIdx)<F)return d.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:y}),void 0}else y.loadCounter=1;y.loadIdx=this.fragLoadIdx,this.fragCurrent=y,this.startFragRequested=!0,isNaN(y.sn)||(this.nextLoadPosition=y.start+y.duration),d.trigger(l.default.FRAG_LOADING,{frag:y}),this.state=z.FRAG_LOADING}}break;case z.WAITING_TRACK:b=this.tracks[this.trackId],b&&b.details&&(this.state=z.IDLE);break;case z.FRAG_LOADING_WAITING_RETRY:G=performance.now(),H=this.retryDate,i=this.media,I=i&&i.seeking,(!H||G>=H||I)&&(t.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=z.IDLE);break;case z.WAITING_INIT_PTS:if(J=this.videoTrackCC,void 0===this.initPTS[J])break;K=this.waitingFragment,K?(L=K.frag.cc,J!==L?(b=this.tracks[this.trackId],b.details&&b.details.live&&(t.logger.warn("Waiting fragment CC ("+L+") does not match video track CC ("+J+")"),this.waitingFragment=null,this.state=z.IDLE)):(this.state=z.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)):this.state=z.IDLE;break;case z.STOPPED:case z.FRAG_LOADING:case z.PARSING:case z.PARSED:case z.ENDED:}}},{key:"onMediaAttached",value:function(a){var c,b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended),c=this.config,this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var b,a=this.media;a&&a.ended&&(t.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),b=this.tracks,b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===z.ENDED&&(this.state=z.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(a){t.logger.log("audio tracks updated"),this.tracks=a.audioTracks}},{key:"onAudioTrackSwitching",value:function(a){var b=!!a.url;this.trackId=a.id,this.fragCurrent=null,this.state=z.PAUSED,this.waitingFragment=null,b?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),b&&(this.audioSwitch=!0,this.state=z.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(a){var g,h,b=a.details,c=a.id,d=this.tracks[c],e=b.totalduration,f=0;t.logger.log("track "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),b.live?(g=d.details,g&&b.fragments.length>0?(p.default.mergeDetails(g,b),f=b.fragments[0].start,b.PTSKnown?t.logger.log("live audio playlist sliding:"+f.toFixed(3)):t.logger.log("live audio playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,t.logger.log("live audio playlist - first load, unknown sliding"))):b.PTSKnown=!1,d.details=b,this.startFragRequested||(-1===this.startPosition&&(h=b.startTimeOffset,isNaN(h)?this.startPosition=0:(t.logger.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h)),this.nextLoadPosition=this.startPosition),this.state===z.WAITING_TRACK&&(this.state=z.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===z.KEY_LOADING&&(this.state=z.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var d,e,f,g,h,i,k,m,n,o,p,b=this.fragCurrent,c=a.frag;this.state===z.FRAG_LOADING&&b&&"audio"===c.type&&c.level===b.level&&c.sn===b.sn&&(d=this.tracks[this.trackId],e=d.details,f=e.totalduration,g=b.level,h=b.sn,i=b.cc,k=this.config.defaultAudioCodec||d.audioCodec||"mp4a.40.2",m=this.stats=a.stats,"initSegment"===h?(this.state=z.IDLE,m.tparsed=m.tbuffered=performance.now(),e.initSegment.data=a.payload,this.hls.trigger(l.default.FRAG_BUFFERED,{stats:m,frag:b,id:"audio"}),this.tick()):(this.state=z.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new j.default(this.hls,"audio")),n=this.initPTS[i],o=e.initSegment?e.initSegment.data:[],e.initSegment||void 0!==n?(this.pendingBuffering=!0,t.logger.log("Demuxing "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g),p=!1,this.demuxer.push(a.payload,o,k,null,b,f,p,n)):(t.logger.log("unknown video PTS for continuity counter "+i+", waiting for video PTS before demuxing audio frag "+h+" of ["+e.startSN+" ,"+e.endSN+"],track "+g),this.waitingFragment=a,this.state=z.WAITING_INIT_PTS))),this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var d,e,f,g,b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===z.PARSING&&(d=a.tracks,e=void 0,d.video&&delete d.video,e=d.audio,e&&(e.levelCodec=e.codec,e.id=a.id,this.hls.trigger(l.default.BUFFER_CODECS,d),t.logger.log("audio track:audio,container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]"),f=e.initSegment,f&&(g={type:"audio",data:f,parent:"audio",content:"initSegment"},this.audioSwitch?this.pendingData=[g]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,g))),this.tick()))}},{key:"onFragParsingData",value:function(a){var e,f,g,h,i,j,k,m,b=this,c=this.fragCurrent,d=a.frag;c&&"audio"===a.id&&"audio"===a.type&&d.sn===c.sn&&d.level===c.level&&this.state===z.PARSING&&(e=this.trackId,f=this.tracks[e],g=this.hls,isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),t.logger.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb),p.default.updateFragPTSDTS(f.details,c,a.startPTS,a.endPTS),h=this.audioSwitch,i=this.media,j=!1,h&&i&&(i.readyState?(k=i.currentTime,t.logger.log("switching audio track : currentTime:"+k),k>=a.startPTS&&(t.logger.log("switching audio track : flushing all audio"),this.state=z.BUFFER_FLUSHING,g.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),j=!0,this.audioSwitch=!1,g.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:e}))):(this.audioSwitch=!1,g.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:e}))),m=this.pendingData,this.audioSwitch||([a.data1,a.data2].forEach(function(b){b&&b.length&&m.push({type:a.type,data:b,parent:"audio",content:"data"})}),!j&&m.length&&(m.forEach(function(a){b.state===z.PARSING&&(b.pendingBuffering=!0,b.hls.trigger(l.default.BUFFER_APPENDING,a))}),this.pendingData=[],this.appended=!0)),this.tick())}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===z.PARSING&&(this.stats.tparsed=performance.now(),this.state=z.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(a){if("audio"===a.parent){var b=this.state;(b===z.PARSING||b===z.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var a,b,c,d;this.state!==z.PARSED||this.appended&&this.pendingBuffering||(a=this.fragCurrent,b=this.stats,c=this.hls,a&&(this.fragPrevious=a,b.tbuffered=performance.now(),c.trigger(l.default.FRAG_BUFFERED,{stats:b,frag:a,id:"audio"}),d=this.mediaBuffer?this.mediaBuffer:this.media,t.logger.log("audio buffered : "+r.default.toString(d.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=z.IDLE),this.tick())}},{key:"onError",value:function(a){var c,d,e,f,g,i,j,b=a.frag;if(!b||"audio"===b.type)switch(a.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:a.fatal||(c=this.fragLoadError,c?c++:c=1,d=this.config,c<=d.fragLoadingMaxRetry?(this.fragLoadError=c,b.loadCounter=0,e=Math.min(Math.pow(2,c-1)*d.fragLoadingRetryDelay,d.fragLoadingMaxRetryTimeout),t.logger.warn("audioStreamController: frag loading failed, retry in "+e+" ms"),this.retryDate=performance.now()+e,this.state=z.FRAG_LOADING_WAITING_RETRY):(t.logger.error("audioStreamController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=z.ERROR));break;case s.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==z.ERROR&&(this.state=a.fatal?z.ERROR:z.IDLE,t.logger.warn("audioStreamController: "+a.details+" while loading frag,switch to "+this.state+" state ..."));break;case s.ErrorDetails.BUFFER_FULL_ERROR:"audio"!==a.parent||this.state!==z.PARSING&&this.state!==z.PARSED||(f=this.mediaBuffer,g=this.media.currentTime,i=f&&h.default.isBuffered(f,g)&&h.default.isBuffered(f,g+.5),i?(j=this.config,j.maxMaxBufferLength>=j.maxBufferLength&&(j.maxMaxBufferLength/=2,t.logger.warn("audio:reduce max buffer length to "+j.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*j.fragLoadingLoopThreshold),this.state=z.IDLE):(t.logger.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=z.BUFFER_FLUSHING,this.hls.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})))}}},{key:"onBufferFlushed",value:function(){var a=this,b=this.pendingData;b&&b.length?(t.logger.log("appending pending audio data on Buffer Flushed"),b.forEach(function(b){a.hls.trigger(l.default.BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state=z.PARSED):(this.state=z.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,t.logger.log("audio stream:"+b+"->"+a)}},get:function(){return this._state}}]),b}(n.default),c.default=A},{25:25,33:33,34:34,35:35,37:37,38:38,48:48,51:51,54:54,55:55}],7:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{"default":a}}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,j,o;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=k(e),g=a(34),h=k(g),i=a(54),j=a(33),o=function(a){function b(a){l(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MANIFEST_LOADING,f.default.MANIFEST_LOADED,f.default.AUDIO_TRACK_LOADED,f.default.ERROR));return c.ticks=0,c.ontick=c.tick.bind(c),c}return n(b,a),d(b,[{key:"destroy",value:function(){this.cleanTimer(),h.default.prototype.destroy.call(this)}},{key:"cleanTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onError",value:function(a){a.fatal&&a.type===j.ErrorTypes.NETWORK_ERROR&&this.cleanTimer()}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(a){var e,b=this,c=a.audioTracks||[],d=!1;this.tracks=c,this.hls.trigger(f.default.AUDIO_TRACKS_UPDATED,{audioTracks:c}),e=0,c.forEach(function(a){return a.default&&!d?(b.audioTrack=e,d=!0,void 0):(e++,void 0)}),d===!1&&c.length&&(i.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(a){a.id<this.tracks.length&&(i.logger.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*a.details.targetduration)),!a.details.live&&this.timer&&this.cleanTimer())}},{key:"setAudioTrackInternal",value:function(a){var b,c,d,e,g,h;a>=0&&a<this.tracks.length&&(this.cleanTimer(),this.trackId=a,i.logger.log("switching to audioTrack "+a),b=this.tracks[a],c=this.hls,d=b.type,e=b.url,g={id:a,type:d,url:e},c.trigger(f.default.AUDIO_TRACK_SWITCH,g),c.trigger(f.default.AUDIO_TRACK_SWITCHING,g),h=b.details,!e||void 0!==h&&h.live!==!0||(i.logger.log("(re)loading playlist for audioTrack "+a),c.trigger(f.default.AUDIO_TRACK_LOADING,{url:e,id:a})))}},{key:"updateTrack",value:function(a){var b,c,d;a>=0&&a<this.tracks.length&&(this.cleanTimer(),this.trackId=a,i.logger.log("updating audioTrack "+a),b=this.tracks[a],c=b.url,d=b.details,!c||void 0!==d&&d.live!==!0||(i.logger.log("(re)loading playlist for audioTrack "+a),this.hls.trigger(f.default.AUDIO_TRACK_LOADING,{url:c,id:a})))}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){(this.trackId!==a||void 0===this.tracks[a].details)&&this.setAudioTrackInternal(a)}}]),b}(h.default),c.default=o},{33:33,34:34,35:35,54:54}],8:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{"default":a}}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,j,o;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=k(e),g=a(34),h=k(g),i=a(54),j=a(33),o=function(a){function b(a){l(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MEDIA_ATTACHING,f.default.MEDIA_DETACHING,f.default.MANIFEST_PARSED,f.default.BUFFER_RESET,f.default.BUFFER_APPENDING,f.default.BUFFER_CODECS,f.default.BUFFER_EOS,f.default.BUFFER_FLUSHING,f.default.LEVEL_PTS_UPDATED,f.default.LEVEL_UPDATED));return c._msDuration=null,c._levelDuration=null,c.onsbue=c.onSBUpdateEnd.bind(c),c.onsbe=c.onSBUpdateError.bind(c),c.pendingTracks={},c.tracks={},c}return n(b,a),d(b,[{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(a){var d,e,f,b=a.type,c=this.tracks.audio;if("audio"===b&&c&&"audio/mpeg"===c.container&&(d=this.sourceBuffer.audio,e=Math.abs(d.timestampOffset-a.start),e>.1)){f=d.updating;try{d.abort()}catch(g){f=!0,i.logger.warn("can not abort audio buffer: "+g)}f?this.audioTimestampOffset=a.start:(i.logger.warn("change mpeg audio timestamp offset from "+d.timestampOffset+" to "+a.start),d.timestampOffset=a.start)}}},{key:"onManifestParsed",value:function(a){var b=a.audio,c=a.video||a.levels.length&&a.audio,d=0;a.altAudio&&(b||c)&&(d=(b?1:0)+(c?1:0),i.logger.log(d+" sourceBuffer(s) expected")),this.sourceBufferNb=d}},{key:"onMediaAttaching",value:function(a){var c,b=this.media=a.media;b&&(c=this.mediaSource=new MediaSource,this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=URL.createObjectURL(c))}},{key:"onMediaDetaching",value:function(){i.logger.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(b){i.logger.warn("onMediaDetaching:"+b.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(f.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){i.logger.log("media source opened"),this.hls.trigger(f.default.MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var a=this.pendingTracks,b=Object.keys(a).length;b&&(this.sourceBufferNb<=b||0===this.sourceBufferNb)&&(this.createSourceBuffers(a),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){i.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){i.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){var a,b,c;this.audioTimestampOffset&&(a=this.sourceBuffer.audio,i.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+this.audioTimestampOffset),a.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset),this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1,b=this.parent,c=this.segments.reduce(function(a,c){return c.parent===b?a+1:a},0),this.hls.trigger(f.default.BUFFER_APPENDED,{parent:b,pending:c}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(a){i.logger.error("sourceBuffer error:",a),this.hls.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var b,c,a=this.sourceBuffer;for(b in a){c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(d){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(a){var b,c;if(0===Object.keys(this.sourceBuffer).length){for(b in a)this.pendingTracks[b]=a[b];c=this.mediaSource,c&&"open"===c.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(a){var d,e,g,h,k,b=this.sourceBuffer,c=this.mediaSource;for(d in a)if(!b[d]){e=a[d],g=e.levelCodec||e.codec,h=e.container+";codecs="+g,i.logger.log("creating sourceBuffer("+h+")");try{k=b[d]=c.addSourceBuffer(h),k.addEventListener("updateend",this.onsbue),k.addEventListener("error",this.onsbe),this.tracks[d]={codec:g,container:e.container},e.buffer=k}catch(l){i.logger.error("error while trying to add sourceBuffer:"+l.message),this.hls.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:l,mimeType:h})}}this.hls.trigger(f.default.BUFFER_CREATED,{tracks:a})}},{key:"onBufferAppending",value:function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())}},{key:"onBufferAppendFail",value:function(a){i.logger.error("sourceBuffer error:",a.event),this.hls.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(a){var d,b=this.sourceBuffer,c=a.type;for(d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,i.logger.log(d+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var c,d,a=this.sourceBuffer,b=this.mediaSource;if(!b||"open"!==b.readyState)return this._needsEos=!1,void 0;for(c in a){if(d=a[c],!d.ended)return;if(d.updating)return this._needsEos=!0,void 0}i.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(e){i.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(a){var b=a.details;0!==b.fragments.length&&(this._levelDuration=b.totalduration+b.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e,f,a=this.media,b=this.mediaSource,c=this.sourceBuffer,d=this._levelDuration;if(null!==d&&a&&b&&c&&0!==a.readyState&&"open"===b.readyState){for(e in c)if(c[e].updating)return;null===this._msDuration&&(this._msDuration=b.duration),f=a.duration,(d>this._msDuration&&d>f||1/0===f||isNaN(f))&&(i.logger.log("Updating mediasource duration to "+d.toFixed(3)),this._msDuration=b.duration=d)}}},{key:"doFlush",value:function(){for(var a,b,c,d;this.flushRange.length;){if(a=this.flushRange[0],!this.flushBuffer(a.start,a.end,a.type))return this._needsFlush=!0,void 0;this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1,b=0,c=this.sourceBuffer;try{for(d in c)b+=c[d].buffered.length}catch(e){i.logger.error("error while accessing sourceBuffer.buffered")}this.appended=b,this.hls.trigger(f.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var d,e,g,k,a=this.hls,b=this.sourceBuffer,c=this.segments;if(Object.keys(b).length){if(this.media.error)return this.segments=[],i.logger.error("trying to append although a media error occured, flush segment and abort"),void 0;if(this.appending)return;if(c&&c.length){d=c.shift();try{e=d.type,g=b[e],g?g.updating?c.unshift(d):(g.ended=!1,this.parent=d.parent,g.appendBuffer(d.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(h){if(i.logger.error("error while trying to append buffer:"+h.message),c.unshift(d),k={type:j.ErrorTypes.MEDIA_ERROR,parent:d.parent},22===h.code)return this.segments=[],k.details=j.ErrorDetails.BUFFER_FULL_ERROR,k.fatal=!1,a.trigger(f.default.ERROR,k),void 0;if(this.appendError?this.appendError++:this.appendError=1,k.details=j.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>a.config.appendErrorMaxRetry)return i.logger.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),c=[],k.fatal=!0,a.trigger(f.default.ERROR,k),void 0;k.fatal=!1,a.trigger(f.default.ERROR,k)}}}}},{key:"flushBuffer",value:function(a,b,c){var d,e,f,g,h,j,l,k=this.sourceBuffer;if(Object.keys(k).length){if(i.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(l in k)if(!c||l===c){if(d=k[l],d.ended=!1,d.updating)return i.logger.warn("cannot flush, sb updating in progress"),!1;try{for(e=0;e<d.buffered.length;e++)if(f=d.buffered.start(e),g=d.buffered.end(e),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&b===Number.POSITIVE_INFINITY?(h=a,j=b):(h=Math.max(f,a),j=Math.min(g,b)),Math.min(j,g)-h>.5)return this.flushBufferCounter++,i.logger.log("flush "+l+" ["+h+","+j+"], of ["+f+","+g+"], pos:"+this.media.currentTime),d.remove(h,j),!1}catch(m){i.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else i.logger.warn("abort flushing too many retries");i.logger.log("buffer flushed")}return!0}}]),b}(h.default),c.default=o},{33:33,34:34,35:35,54:54}],9:[function(a,b,c){"use strict";function i(a){return a&&a.__esModule?a:{"default":a}}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function l(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,m;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=i(e),g=a(34),h=i(g),m=function(a){function b(a){return j(this,b),k(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.FPS_DROP_LEVEL_CAPPING,f.default.MEDIA_ATTACHING,f.default.MANIFEST_PARSED))}return l(b,a),d(b,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(a){b.isLevelAllowed(a.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(a.droppedLevel)}},{key:"onMediaAttaching",value:function(a){this.media=a.media instanceof HTMLVideoElement?a.media:null}},{key:"onManifestParsed",value:function(a){var b=this.hls;this.restrictedLevels=[],b.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=a.levels,b.firstLevel=this.getMaxLevel(a.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){var a,b;this.media&&(a=this.levels?this.levels.length:0,a&&(b=this.hls,b.autoLevelCapping=this.getMaxLevel(a-1),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping))}},{key:"getMaxLevel",value:function(a){var d,c=this;return this.levels?(d=this.levels.filter(function(d,e){return b.isLevelAllowed(e,c.restrictedLevels)&&a>=e}),b.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)):-1}},{key:"mediaWidth",get:function(){var a=void 0,c=this.media;return c&&(a=c.width||c.clientWidth||c.offsetWidth,a*=b.contentScaleFactor),a}},{key:"mediaHeight",get:function(){var a=void 0,c=this.media;return c&&(a=c.height||c.clientHeight||c.offsetHeight,a*=b.contentScaleFactor),a}}],[{key:"isLevelAllowed",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return-1===b.indexOf(a)}},{key:"getMaxLevelByMediaSize",value:function(a,b,c){var d,e,f,g;if(!a||a&&!a.length)return-1;for(d=function(a,b){return b?a.width!==b.width||a.height!==b.height:!0},e=a.length-1,f=0;f<a.length;f+=1)if(g=a[f],(g.width>=b||g.height>=c)&&d(g,a[f+1])){e=f;break}return e}},{key:"contentScaleFactor",get:function(){var a=1;try{a=window.devicePixelRatio}catch(b){}return a}}]),b}(h.default),c.default=m},{34:34,35:35}],10:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function m(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,n;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=j(e),g=a(34),h=j(g),i=a(54),n=function(a){function b(a){return k(this,b),l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MEDIA_ATTACHING))}return m(b,a),d(b,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(a){var c,b=this.hls.config;b.capLevelOnFPSDrop&&(c=this.video=a.media instanceof HTMLVideoElement?a.media:null,"function"==typeof c.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod))}},{key:"checkFPS",value:function(a,b,c){var e,g,h,j,k,l,d=performance.now();b&&(this.lastTime&&(e=d-this.lastTime,g=c-this.lastDroppedFrames,h=b-this.lastDecodedFrames,j=1e3*g/e,k=this.hls,k.trigger(f.default.FPS_DROP,{currentDropped:g,currentDecoded:h,totalDroppedFrames:c}),j>0&&g>k.config.fpsDroppedMonitoringThreshold*h&&(l=k.currentLevel,i.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(-1===k.autoLevelCapping||k.autoLevelCapping>=l)&&(l-=1,k.trigger(f.default.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:k.currentLevel}),k.autoLevelCapping=l,k.streamController.nextLevelSwitch()))),this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b)}},{key:"checkFPSInterval",value:function(){var b,a=this.video;a&&(this.isVideoPlaybackQualityAvailable?(b=a.getVideoPlaybackQuality(),this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)):this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount))}}]),b}(h.default),c.default=n},{34:34,35:35,54:54}],11:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{"default":a}}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,j,o;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=k(e),g=a(34),h=k(g),i=a(27),j=k(i),o=function(a){function b(a){l(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MEDIA_ATTACHED,f.default.MEDIA_DETACHING,f.default.FRAG_PARSING_METADATA));return c.id3Track=void 0,c.media=void 0,c}return n(b,a),d(b,[{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(a){this.media=a.media,this.media&&(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden")}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onFragParsingMetadata",value:function(a){var e,f,g,h,i,k,l,b=a.frag,c=a.samples,d=window.WebKitDataCue||window.VTTCue||window.TextTrackCue;for(e=0;e<c.length;e++)if(f=j.default.getID3Frames(c[e].data))for(g=c[e].pts,h=e<c.length-1?c[e+1].pts:b.endPTS,g===h&&(h+=1e-4),i=0;i<f.length;i++)k=f[i],j.default.isTimeStampFrame(k)||(l=new d(g,h,""),l.value=k,this.id3Track.addCue(l))}}]),b}(h.default),c.default=o},{27:27,34:34,35:35}],12:[function(a,b,c){"use strict";function m(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function o(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function p(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,j,k,l,q;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=m(e),g=a(34),h=m(g),i=a(54),j=a(33),k=a(37),l=m(k),q=function(a){function b(a){n(this,b);var c=o(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MANIFEST_LOADED,f.default.LEVEL_LOADED,f.default.FRAG_LOADED,f.default.ERROR));return c.ontick=c.tick.bind(c),c._manualLevel=-1,c}return p(b,a),d(b,[{key:"destroy",value:function(){this.cleanTimer(),this._manualLevel=-1}},{key:"cleanTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"startLoad",value:function(){this.canload=!0;var a=this._levels;a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(a){var d,n,b=[],c=[],e={},g=!1,h=!1,k=this.hls,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),m=function(a,b){return MediaSource.isTypeSupported(a+"/mp4;codecs="+b)};if(a.levels.forEach(function(a){a.videoCodec&&(g=!0),l&&a.audioCodec&&-1!==a.audioCodec.indexOf("mp4a.40.34")&&(a.audioCodec=void 0),(a.audioCodec||a.attrs&&a.attrs.AUDIO)&&(h=!0);var c=e[a.bitrate];void 0===c?(e[a.bitrate]=b.length,a.url=[a.url],a.urlId=0,b.push(a)):b[c].url.push(a.url)}),g&&h?b.forEach(function(a){a.videoCodec&&c.push(a)}):c=b,c=c.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return!(b&&!m("audio",b)||c&&!m("video",c))}),c.length){for(d=c[0].bitrate,c.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=c,n=0;n<c.length;n++)if(c[n].bitrate===d){this._firstLevel=n,i.logger.log("manifest loaded,"+c.length+" level(s) found, first bitrate:"+d);break}k.trigger(f.default.MANIFEST_PARSED,{levels:c,firstLevel:this._firstLevel,stats:a.stats,audio:h,video:g,altAudio:a.audioTracks.length>0})}else k.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:k.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(a){var d,e,g,h,b=this._levels,c=this.hls;a>=0&&a<b.length?(this.cleanTimer(),this._level!==a&&(i.logger.log("switching to level "+a),this._level=a,d=b[a],d.level=a,c.trigger(f.default.LEVEL_SWITCH,d),c.trigger(f.default.LEVEL_SWITCHING,d)),e=b[a],g=e.details,g&&g.live!==!0||(h=e.urlId,c.trigger(f.default.LEVEL_LOADING,{url:e.url[h],level:a,id:h}))):c.trigger(f.default.ERROR,{type:j.ErrorTypes.OTHER_ERROR,details:j.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(a){var b,c,d,e,f,g,h,k,m,n;if(a.fatal)return a.type===j.ErrorTypes.NETWORK_ERROR&&this.cleanTimer(),void 0;switch(b=a.details,c=this.hls,d=void 0,e=void 0,f=!1,b){case j.ErrorDetails.FRAG_LOAD_ERROR:case j.ErrorDetails.FRAG_LOAD_TIMEOUT:case j.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case j.ErrorDetails.KEY_LOAD_ERROR:case j.ErrorDetails.KEY_LOAD_TIMEOUT:d=a.frag.level;break;case j.ErrorDetails.LEVEL_LOAD_ERROR:case j.ErrorDetails.LEVEL_LOAD_TIMEOUT:d=a.context.level,f=!0;break;case j.ErrorDetails.REMUX_ALLOC_ERROR:d=a.level}void 0!==d&&(e=this._levels[d],e.loadError?e.loadError++:e.loadError=1,g=e.url.length,g>1&&e.loadError<g?(e.urlId=(e.urlId+1)%g,e.details=void 0,i.logger.warn("level controller,"+b+" for level "+d+": switching to redundant stream id "+e.urlId)):(h=-1===this._manualLevel&&d,h?(i.logger.warn("level controller,"+b+": switch-down for next fragment"),c.nextAutoLevel=Math.max(0,d-1)):e&&e.details&&e.details.live?(i.logger.warn("level controller,"+b+" on live stream, discard"),f&&(this._level=void 0)):(b===j.ErrorDetails.LEVEL_LOAD_ERROR||b===j.ErrorDetails.LEVEL_LOAD_TIMEOUT)&&(k=c.media,m=k&&l.default.isBuffered(k,k.currentTime)&&l.default.isBuffered(k,k.currentTime+.5),m?(n=c.config.levelLoadingRetryDelay,i.logger.warn("level controller,"+b+", but media buffered, retry in "+n+"ms"),this.timer=setTimeout(this.ontick,n),a.levelRetry=!0):(i.logger.error("cannot recover "+b+" error"),this._level=void 0,this.cleanTimer(),a.fatal=!0))))}},{key:"onFragLoaded",value:function(a){var c,b=a.frag;b&&"main"===b.type&&(c=this._levels[b.level],c&&(c.loadError=0))}},{key:"onLevelLoaded",value:function(a){var c,d,e,f,b=a.level;b===this._level&&(c=this._levels[b],c.loadError=0,d=a.details,d.live?(e=1e3*(d.averagetargetduration?d.averagetargetduration:d.targetduration),f=c.details,f&&d.endSN===f.endSN&&(e/=2,i.logger.log("same live playlist, reload twice faster")),e-=performance.now()-a.stats.trequest,e=Math.max(1e3,Math.round(e)),i.logger.log("live playlist, reload in "+e+" ms"),this.timer=setTimeout(this.ontick,e)):this.timer=null)}},{key:"tick",value:function(){var b,c,a=this._level;void 0!==a&&this.canload&&(b=this._levels[a],b&&b.url&&(c=b.urlId,this.hls.trigger(f.default.LEVEL_LOADING,{url:b.url[c],level:a,id:c})))}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(a){var b=this._levels;b&&b.length>a&&(this._level!==a||void 0===b[a].details)&&this.setLevelInternal(a)}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(a){this._manualLevel=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this._manualLevel&&(this.hls.nextAutoLevel=a)}}]),b}(h.default),c.default=q},{33:33,34:34,35:35,37:37,54:54}],13:[function(a,b,c){"use strict";function u(a){return a&&a.__esModule?a:{"default":a}}function v(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function w(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function x(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,y,z;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(48),f=u(e),g=a(37),h=u(g),i=a(25),j=u(i),k=a(35),l=u(k),m=a(34),n=u(m),o=a(38),p=u(o),q=a(55),r=u(q),s=a(33),t=a(54),y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},z=function(a){function b(a){v(this,b);var c=w(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADING,l.default.MANIFEST_PARSED,l.default.LEVEL_LOADED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_LOAD_EMERGENCY_ABORTED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_SWITCHED,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c._state=y.STOPPED,c.ontick=c.tick.bind(c),c}return x(b,a),d(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),n.default.prototype.destroy.call(this),this.state=y.STOPPED}},{key:"startLoad",value:function(a){var b,c,d;this.levels?(b=this.lastCurrentTime,c=this.hls,this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,this.startFragRequested||(d=c.startLevel,-1===d&&(d=0,this.bitrateTest=!0),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1),b>0&&-1===a&&(t.logger.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=y.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()):(this.forceStartLoad=!0,this.state=y.STOPPED)}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.STOPPED,this.forceStartLoad=!1}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var a,b,c;switch(this.state){case y.ERROR:break;case y.BUFFER_FLUSHING:this.fragLoadError=0;break;case y.IDLE:this._doTickIdle();break;case y.WAITING_LEVEL:a=this.levels[this.level],a&&a.details&&(this.state=y.IDLE);break;case y.FRAG_LOADING_WAITING_RETRY:b=performance.now(),c=this.retryDate,(!c||b>=c||this.media&&this.media.seeking)&&(t.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=y.IDLE);break;case y.ERROR:case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var d,e,f,g,i,j,k,m,n,o,p,a=this.hls,b=a.config,c=this.media;
if((void 0===this.levelLastLoaded||c||!this.startFragRequested&&b.startFragPrefetch)&&(d=void 0,d=this.loadedmetadata?c.currentTime:this.nextLoadPosition,e=a.nextLoadLevel,f=this.levels[e],f&&(g=f.bitrate,i=void 0,i=g?Math.max(8*b.maxBufferSize/g,b.maxBufferLength):b.maxBufferLength,i=Math.min(i,b.maxMaxBufferLength),j=h.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),k=j.len,!(k>=i))))return t.logger.trace("buffer length of "+k.toFixed(3)+" is below max of "+i.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e,m=f.details,"undefined"==typeof m||m.live&&this.levelLastLoaded!==e?(this.state=y.WAITING_LEVEL,void 0):(n=this.fragPrevious,!m.live&&n&&n.sn===m.endSN&&k&&!j.nextStart&&(o=Math.min(c.duration,n.start+n.duration),o-Math.max(j.end,n.start)<=Math.max(.2,n.duration))?(p={},this.altAudio&&(p.type="video"),this.hls.trigger(l.default.BUFFER_EOS,p),this.state=y.ENDED,void 0):(this._fetchPayloadOrEos(d,j,m),void 0))}},{key:"_fetchPayloadOrEos",value:function(a,b,c){var h,i,j,k,l,d=this.fragPrevious,e=this.level,f=c.fragments,g=f.length;if(0!==g){if(h=f[0].start,i=f[g-1].start+f[g-1].duration,j=b.end,k=void 0,c.initSegment&&!c.initSegment.data)k=c.initSegment;else if(c.live){if(l=this.config.initialLiveManifestSize,l>g)return t.logger.warn("Can not start playback of a level, reason: not enough fragments "+g+" < "+l),void 0;if(k=this._ensureFragmentAtLivePoint(c,j,h,i,d,f,g),null===k)return}else h>j&&(k=f[0]);k||(k=this._findFragment(h,d,g,f,j,i,c)),k&&this._loadFragmentOrKey(k,e,c,a,j)}}},{key:"_ensureFragmentAtLivePoint",value:function(a,b,c,d,e,g,h){var m,n,o,i=this.hls.config,j=this.media,k=void 0,l=void 0!==i.liveMaxLatencyDuration?i.liveMaxLatencyDuration:i.liveMaxLatencyDurationCount*a.targetduration;return b<Math.max(c-i.maxFragLookUpTolerance,d-l)&&(m=this.liveSyncPosition=this.computeLivePosition(c,a),t.logger.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+m.toFixed(3)),b=m,j&&j.readyState&&j.duration>m&&(j.currentTime=m),this.nextLoadPosition=m),a.PTSKnown&&b>d&&j&&j.readyState?null:(this.startFragRequested&&!a.PTSKnown&&(e&&(n=e.sn+1,n>=a.startSN&&n<=a.endSN&&(o=g[n-a.startSN],e.cc===o.cc&&(k=o,t.logger.log("live playlist, switching playlist, load frag with next SN: "+k.sn))),k||(k=f.default.search(g,function(a){return e.cc-a.cc}),k&&t.logger.log("live playlist, switching playlist, load frag with same CC: "+k.sn))),k||(k=g[Math.min(h-1,Math.round(h/2))],t.logger.log("live playlist, switching playlist, unknown, load middle frag : "+k.sn))),k)}},{key:"_findFragment",value:function(a,b,c,d,e,g,h){var o,p,q,r,s,i=this.hls.config,j=void 0,k=void 0,l=i.maxFragLookUpTolerance,m=b?d[b.sn-d[0].sn+1]:void 0,n=function(a){var b=Math.min(l,a.duration);return a.start+a.duration-b<=e?1:a.start-b>e&&a.start?-1:0};return g>e?(e>g-l&&(l=0),k=m&&!n(m)?m:f.default.search(d,n)):k=d[c-1],k&&(j=k,o=j.sn-h.startSN,p=b&&j.level===b.level,q=d[o-1],r=d[o+1],b&&j.sn===b.sn&&(p&&!j.backtracked?j.sn<h.endSN?(s=b.deltaPTS,s&&s>i.maxBufferHole&&b.dropped&&o?(j=q,t.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),b.loadCounter--):(j=r,t.logger.log("SN just loaded, load next one: "+j.sn))):j=null:j.backtracked&&(r&&r.backtracked?(t.logger.warn("Already backtracked from fragment "+r.sn+", will not backtrack to fragment "+j.sn+". Loading fragment "+r.sn),j=r):(t.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),j.dropped=0,q?(q.loadCounter&&q.loadCounter--,j=q,j.backtracked=!0):o&&(j=null))))),j}},{key:"_loadFragmentOrKey",value:function(a,b,c,d,e){var h,f=this.hls,g=f.config;if(!a.decryptdata||null==a.decryptdata.uri||null!=a.decryptdata.key){if(t.logger.log("Loading "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b+", currentTime:"+d.toFixed(3)+",bufferEnd:"+e.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,a.loadCounter){if(a.loadCounter++,h=g.fragLoadingLoopThreshold,a.loadCounter>h&&Math.abs(this.fragLoadIdx-a.loadIdx)<h)return f.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:a}),void 0}else a.loadCounter=1;return a.loadIdx=this.fragLoadIdx,this.fragCurrent=a,this.startFragRequested=!0,isNaN(a.sn)||(this.nextLoadPosition=a.start+a.duration),a.autoLevel=f.autoLevelEnabled,a.bitrateTest=this.bitrateTest,f.trigger(l.default.FRAG_LOADING,{frag:a}),this.demuxer||(this.demuxer=new j.default(f,"main")),this.state=y.FRAG_LOADING,void 0}t.logger.log("Loading key for "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b),this.state=y.KEY_LOADING,f.trigger(l.default.KEY_LOADING,{frag:a})}},{key:"getBufferedFrag",value:function(a){return f.default.search(this._bufferedFrags,function(b){return a<b.startPTS?-1:a>b.endPTS?1:0})}},{key:"followingBufferedFrag",value:function(a){return a?this.getBufferedFrag(a.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function(){var a,b,d,e,c=this.media;c&&c.readyState&&c.seeking===!1&&(b=c.currentTime,b>c.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=b),h.default.isBuffered(c,b)?a=this.getBufferedFrag(b):h.default.isBuffered(c,b+.1)&&(a=this.getBufferedFrag(b+.1)),a&&(d=a,d!==this.fragPlaying&&(this.hls.trigger(l.default.FRAG_CHANGED,{frag:d}),e=d.level,this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(l.default.LEVEL_SWITCHED,{level:e}),this.fragPlaying=d)))}},{key:"immediateLevelSwitch",value:function(){var a,b,c;t.logger.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,a=this.media,b=void 0,a?(b=a.paused,a.pause()):b=!0,this.previouslyPaused=b),c=this.fragCurrent,c&&c.loader&&c.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,h.default.isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())}},{key:"nextLevelSwitch",value:function(){var b,c,d,e,f,g,h,a=this.media;a&&a.readyState&&(b=void 0,c=void 0,d=void 0,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,c=this.getBufferedFrag(a.currentTime),c&&c.startPTS>1&&this.flushMainBuffer(0,c.startPTS-1),a.paused?b=0:(e=this.hls.nextLoadLevel,f=this.levels[e],g=this.fragLastKbps,b=g&&this.fragCurrent?this.fragCurrent.duration*f.bitrate/(1e3*g)+1:0),d=this.getBufferedFrag(a.currentTime+b),d&&(d=this.followingBufferedFrag(d),d&&(h=this.fragCurrent,h&&h.loader&&h.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(d.maxStartPTS,Number.POSITIVE_INFINITY))))}},{key:"flushMainBuffer",value:function(a,b){this.state=y.BUFFER_FLUSHING;var c={startOffset:a,endOffset:b};this.altAudio&&(c.type="video"),this.hls.trigger(l.default.BUFFER_FLUSHING,c)}},{key:"onMediaAttached",value:function(a){var c,b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended),c=this.config,this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var b,a=this.media;a&&a.ended&&(t.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),b=this.levels,b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0,a.backtracked=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var d,e,f,g,i,j,a=this.media,b=a?a.currentTime:void 0,c=this.config;isNaN(b)||t.logger.log("media seeking to "+b.toFixed(3)),d=this.mediaBuffer?this.mediaBuffer:a,e=h.default.bufferInfo(d,b,this.config.maxBufferHole),this.state===y.FRAG_LOADING?(f=this.fragCurrent,0===e.len&&f&&(g=c.maxFragLookUpTolerance,i=f.start-g,j=f.start+f.duration+g,i>b||b>j?(f.loader&&(t.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),f.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=y.IDLE):t.logger.log("seeking outside of buffer but within currently loaded fragment range"))):this.state===y.ENDED&&(0===e.len&&(this.fragPrevious=0),this.state=y.IDLE),a&&(this.lastCurrentTime=b),this.state!==y.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*c.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=b),this.tick()}},{key:"onMediaSeeked",value:function(){var a=this.media,b=a?a.currentTime:void 0;isNaN(b)||t.logger.log("media seeked to "+b.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){t.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){t.logger.log("trigger BUFFER_RESET"),this.hls.trigger(l.default.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(a){var d,e,b=!1,c=!1;a.levels.forEach(function(a){d=a.audioCodec,d&&(-1!==d.indexOf("mp4a.40.2")&&(b=!0),-1!==d.indexOf("mp4a.40.5")&&(c=!0))}),this.audioCodecSwitch=b&&c,this.audioCodecSwitch&&t.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startLevelLoaded=!1,this.startFragRequested=!1,e=this.config,(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)}},{key:"onLevelLoaded",value:function(a){var g,h,b=a.details,c=a.level,d=this.levels[c],e=b.totalduration,f=0;t.logger.log("level "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),this.levelLastLoaded=c,b.live?(g=d.details,g&&b.fragments.length>0?(p.default.mergeDetails(g,b),f=b.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(f,g),b.PTSKnown?t.logger.log("live playlist sliding:"+f.toFixed(3)):t.logger.log("live playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,t.logger.log("live playlist - first load, unknown sliding"))):b.PTSKnown=!1,d.details=b,this.hls.trigger(l.default.LEVEL_UPDATED,{details:b,level:c}),this.startFragRequested===!1&&((-1===this.startPosition||-1===this.lastCurrentTime)&&(h=b.startTimeOffset,isNaN(h)?b.live?(this.startPosition=this.computeLivePosition(f,b),t.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(0>h&&(t.logger.log("negative start time offset "+h+", count from end of last fragment"),h=f+e+h),t.logger.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h),this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition),this.state===y.WAITING_LEVEL&&(this.state=y.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.KEY_LOADING&&(this.state=y.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var d,e,f,g,h,i,k,m,n,o,p,q,b=this.fragCurrent,c=a.frag;this.state===y.FRAG_LOADING&&b&&"main"===c.type&&c.level===b.level&&c.sn===b.sn&&(d=a.stats,e=this.levels[b.level],f=e.details,t.logger.log("Loaded  "+b.sn+" of ["+f.startSN+" ,"+f.endSN+"],level "+b.level),this.bitrateTest=!1,this.stats=d,c.bitrateTest===!0&&this.hls.nextLoadLevel?(this.state=y.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=performance.now(),this.hls.trigger(l.default.FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick()):"initSegment"===c.sn?(this.state=y.IDLE,d.tparsed=d.tbuffered=performance.now(),f.initSegment.data=a.payload,this.hls.trigger(l.default.FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick()):(this.state=y.PARSING,g=f.totalduration,h=b.level,i=b.sn,k=this.config.defaultAudioCodec||e.audioCodec,this.audioCodecSwap&&(t.logger.log("swapping playlist audio codec"),void 0===k&&(k=this.lastAudioCodec),k&&(k=-1!==k.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,t.logger.log("Parsing "+i+" of ["+f.startSN+" ,"+f.endSN+"],level "+h+", cc "+b.cc),m=this.demuxer,m||(m=this.demuxer=new j.default(this.hls,"main")),n=this.media,o=n&&n.seeking,p=!o&&(f.PTSKnown||!f.live),q=f.initSegment?f.initSegment.data:[],m.push(a.payload,q,k,e.videoCodec,b,g,p,void 0))),this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var e,f,d,g,h,i,b=this.fragCurrent,c=a.frag;if(b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING){d=a.tracks,d.audio&&this.altAudio&&delete d.audio,f=d.audio,f&&(g=this.levels[this.level].audioCodec,h=navigator.userAgent.toLowerCase(),g&&this.audioCodecSwap&&(t.logger.log("swapping playlist audio codec"),g=-1!==g.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==f.metadata.channelCount&&-1===h.indexOf("firefox")&&(g="mp4a.40.5"),-1!==h.indexOf("android")&&"audio/mpeg"!==f.container&&(g="mp4a.40.2",t.logger.log("Android: force audio codec to "+g)),f.levelCodec=g,f.id=a.id),f=d.video,f&&(f.levelCodec=this.levels[this.level].videoCodec,f.id=a.id),this.hls.trigger(l.default.BUFFER_CODECS,d);for(e in d)f=d[e],t.logger.log("main track:"+e+",container:"+f.container+",codecs[level/parsed]=["+f.levelCodec+"/"+f.codec+"]"),i=f.initSegment,i&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,{type:e,data:i,parent:"main",content:"initSegment"}));this.tick()}}},{key:"onFragParsingData",value:function(a){var e,f,g,h,b=this,c=this.fragCurrent,d=a.frag;if(c&&"main"===a.id&&d.sn===c.sn&&d.level===c.level&&("audio"!==a.type||!this.altAudio)&&this.state===y.PARSING){if(e=this.levels[this.level],f=c,isNaN(a.endPTS)&&(a.endPTS=a.startPTS+c.duration,a.endDTS=a.startDTS+c.duration),t.logger.log("Parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb+",dropped:"+(a.dropped||0)),"video"===a.type)if(f.dropped=a.dropped,f.dropped){if(!f.backtracked)return t.logger.warn("missing video frame(s), backtracking fragment"),f.backtracked=!0,this.nextLoadPosition=a.startPTS,this.state=y.IDLE,this.fragPrevious=f,this.tick(),void 0;t.logger.warn("Already backtracked on this fragment, appending with the gap")}else f.backtracked=!1;g=p.default.updateFragPTSDTS(e.details,f,a.startPTS,a.endPTS,a.startDTS,a.endDTS),h=this.hls,h.trigger(l.default.LEVEL_PTS_UPDATED,{details:e.details,level:this.level,drift:g,type:a.type,start:a.startPTS,end:a.endPTS}),[a.data1,a.data2].forEach(function(c){c&&c.length&&b.state===y.PARSING&&(b.appended=!0,b.pendingBuffering=!0,h.trigger(l.default.BUFFER_APPENDING,{type:a.type,data:c,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent,c=a.frag;b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===y.PARSING&&(this.stats.tparsed=performance.now(),this.state=y.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(a){var d,e,b=!!a.url,c=a.id;b||(this.mediaBuffer!==this.media&&(t.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,d=this.fragCurrent,d.loader&&(t.logger.log("switching to main audio track, cancel main fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.IDLE),e=this.hls,e.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),e.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:c}),this.altAudio=!1)}},{key:"onAudioTrackSwitched",value:function(a){var d,b=a.id,c=!!this.hls.audioTracks[b].url;c&&(d=this.videoBuffer,d&&this.mediaBuffer!==d&&(t.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)),this.altAudio=c,this.tick()}},{key:"onBufferCreated",value:function(a){var f,g,b=a.tracks,c=void 0,d=void 0,e=!1;for(f in b)g=b[f],"main"===g.id?(d=f,c=g,"video"===f&&(this.videoBuffer=b[f].buffer)):e=!0;e&&c?(t.logger.log("alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(a){if("main"===a.parent){var b=this.state;(b===y.PARSING||b===y.PARSED)&&(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var a,b,c,d;this.state!==y.PARSED||this.appended&&this.pendingBuffering||(a=this.fragCurrent,a&&(b=this.mediaBuffer?this.mediaBuffer:this.media,t.logger.log("main buffered : "+r.default.toString(b.buffered)),c=this._bufferedFrags.filter(function(a){return h.default.isBuffered(b,(a.startPTS+a.endPTS)/2)}),c.push(a),this._bufferedFrags=c.sort(function(a,b){return a.startPTS-b.startPTS}),this.fragPrevious=a,d=this.stats,d.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*d.total/(d.tbuffered-d.tfirst)),this.hls.trigger(l.default.FRAG_BUFFERED,{stats:d,frag:a,id:"main"}),this.state=y.IDLE),this.tick())}},{key:"onError",value:function(a){var c,d,e,f,g,b=a.frag||this.fragCurrent;if(!b||"main"===b.type)switch(c=this.media,d=c&&h.default.isBuffered(c,c.currentTime)&&h.default.isBuffered(c,c.currentTime+.5),a.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:a.fatal||(e=this.fragLoadError,e?e++:e=1,f=this.config,e<=f.fragLoadingMaxRetry||d||b.autoLevel&&b.level?(this.fragLoadError=e,b.loadCounter=0,g=Math.min(Math.pow(2,e-1)*f.fragLoadingRetryDelay,f.fragLoadingMaxRetryTimeout),t.logger.warn("mediaController: frag loading failed, retry in "+g+" ms"),this.retryDate=performance.now()+g,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=y.FRAG_LOADING_WAITING_RETRY):(t.logger.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.state=y.ERROR));break;case s.ErrorDetails.FRAG_LOOP_LOADING_ERROR:a.fatal||(d?(this._reduceMaxBufferLength(b.duration),this.state=y.IDLE):b.autoLevel&&0!==b.level||(a.fatal=!0,this.state=y.ERROR));break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.ERROR&&(a.fatal?(this.state=y.ERROR,t.logger.warn("streamController: "+a.details+",switch to "+this.state+" state ...")):a.levelRetry||this.state!==y.WAITING_LEVEL||(this.state=y.IDLE));break;case s.ErrorDetails.BUFFER_FULL_ERROR:"main"!==a.parent||this.state!==y.PARSING&&this.state!==y.PARSED||(d?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=y.IDLE):(t.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},{key:"_reduceMaxBufferLength",value:function(a){var b=this.config;b.maxMaxBufferLength>=a&&(b.maxMaxBufferLength/=2,t.logger.warn("main:reduce max buffer length to "+b.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*b.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var c,d,e,f,g,i,j,k,m,n,o,p,q,r,u,v,w,x,y,z,a=this.media,b=this.config;a&&a.readyState&&(c=a.currentTime,d=this.mediaBuffer?this.mediaBuffer:a,e=d.buffered,!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,f=a.seeking?c:this.startPosition,g=h.default.isBuffered(d,f),i=e.start(0),(c!==f||!g&&Math.abs(f-i)<b.maxSeekHole)&&(t.logger.log("target start position:"+f),g||(f=i,t.logger.log("target start position not buffered, seek to buffered.start(0) "+f)),t.logger.log("adjust currentTime from "+c+" to "+f),a.currentTime=f)):this.immediateSwitch?this.immediateLevelSwitchEnd():(j=h.default.bufferInfo(a,c,0),k=!(a.paused||a.ended||0===a.buffered.length),m=.5,n=c!==this.lastCurrentTime,n?(this.stallReported&&(t.logger.warn("playback not stuck anymore @"+c+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0):k&&(o=performance.now(),p=this.hls,this.stalled?(q=o-this.stalled,r=j.len,u=this.nudgeRetry||0,m>=r&&q>1e3*b.lowBufferWatchdogPeriod?(this.stallReported||(this.stallReported=!0,t.logger.warn("playback stalling in low buffer @"+c),p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:r})),v=j.nextStart,w=v-c,v&&w<b.maxSeekHole&&w>0&&(this.nudgeRetry=++u,x=u*b.nudgeOffset,t.logger.log("adjust currentTime from "+a.currentTime+" to next buffered @ "+v+" + nudge "+x),a.currentTime=v+x,this.stalled=void 0,p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:v+x-c}))):r>m&&q>1e3*b.highBufferWatchdogPeriod&&(this.stallReported||(this.stallReported=!0,t.logger.warn("playback stalling in high buffer @"+c),p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:r})),this.stalled=void 0,this.nudgeRetry=++u,u<b.nudgeMaxRetry?(y=a.currentTime,z=y+u*b.nudgeOffset,t.logger.log("adjust currentTime from "+y+" to "+z),a.currentTime=z,p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(t.logger.error("still stuck in high buffer @"+c+" after "+b.nudgeMaxRetry+", raise fatal error"),p.trigger(l.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})))):(this.stalled=o,this.stallReported=!1))))}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=y.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(b){return h.default.isBuffered(a,(b.startPTS+b.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=y.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)}},{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,t.logger.log("main stream:"+b+"->"+a),this.hls.trigger(l.default.STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var b,a=this.media;return a&&(b=this.getBufferedFrag(a.currentTime))?b.level:-1}},{key:"nextBufferedFrag",get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null}},{key:"nextLevel",get:function(){var a=this.nextBufferedFrag;return a?a.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a}}]),b}(n.default),c.default=z},{25:25,33:33,34:34,35:35,37:37,38:38,48:48,54:54,55:55}],14:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function m(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,n;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=j(e),g=a(34),h=j(g),i=a(54),n=function(a){function b(a){k(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.ERROR,f.default.SUBTITLE_TRACKS_UPDATED,f.default.SUBTITLE_TRACK_SWITCH,f.default.SUBTITLE_TRACK_LOADED,f.default.SUBTITLE_FRAG_PROCESSED));return c.config=a.config,c.vttFragSNsProcessed={},c.vttFragQueues=void 0,c.currentlyProcessing=null,c.currentTrackId=-1,c}return m(b,a),d(b,[{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"clearVttFragQueues",value:function(){var a=this;this.vttFragQueues={},this.tracks.forEach(function(b){a.vttFragQueues[b.id]=[]})}},{key:"nextFrag",value:function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var a=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(f.default.FRAG_LOADING,{frag:a})}}},{key:"onSubtitleFragProcessed",value:function(a){a.success&&this.vttFragSNsProcessed[a.frag.trackId].push(a.frag.sn),this.currentlyProcessing=null,this.nextFrag()}},{key:"onError",value:function(a){var b=a.frag;b&&"subtitle"!==b.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())}},{key:"onSubtitleTracksUpdated",value:function(a){var b=this;i.logger.log("subtitle tracks updated"),this.tracks=a.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(a){b.vttFragSNsProcessed[a.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(a){this.currentTrackId=a.id,this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function(a){var b=this.vttFragSNsProcessed[a.id],c=this.vttFragQueues[a.id],d=this.currentlyProcessing?this.currentlyProcessing.sn:-1,e=function(a){return b.indexOf(a.sn)>-1},f=function(a){return c.some(function(b){return b.sn===a.sn})};a.details.fragments.forEach(function(b){e(b)||b.sn===d||f(b)||(b.trackId=a.id,c.push(b))}),this.nextFrag()}}]),b}(h.default),c.default=n},{34:34,35:35,54:54}],15:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function l(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function m(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a){var c,b=[];for(c=0;c<a.length;c++)"subtitles"===a[c].kind&&b.push(a[c]);return b}var d,e,f,g,h,i,o;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=j(e),g=a(34),h=j(g),i=a(54),o=function(a){function b(a){k(this,b);var c=l(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MEDIA_ATTACHED,f.default.MEDIA_DETACHING,f.default.MANIFEST_LOADING,f.default.MANIFEST_LOADED,f.default.SUBTITLE_TRACK_LOADED));return c.tracks=[],c.trackId=-1,c.media=void 0,c}return m(b,a),d(b,[{key:"_onTextTracksChanged",value:function(){var a,b,c;if(this.media){for(a=-1,b=n(this.media.textTracks),c=0;c<b.length;c++)"showing"===b[c].mode&&(a=c);this.subtitleTrack=a}}},{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(a){this.media=a.media,this.media&&(this.trackChangeListener=this._onTextTracksChanged.bind(this),this.media.textTracks.addEventListener("change",this.trackChangeListener))}},{key:"onMediaDetaching",value:function(){this.media&&(this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(a){var b=this,c=a.subtitles||[],d=!1;this.tracks=c,this.trackId=-1,this.hls.trigger(f.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:c}),c.forEach(function(a){a.default&&(b.subtitleTrack=a.id,d=!0)})}},{key:"onTick",value:function(){var c,a=this.trackId,b=this.tracks[a];b&&(c=b.details,(void 0===c||c.live===!0)&&(i.logger.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(f.default.SUBTITLE_TRACK_LOADING,{url:b.url,id:a})))}},{key:"onSubtitleTrackLoaded",value:function(a){var b=this;a.id<this.tracks.length&&(i.logger.log("subtitle track "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(function(){b.onTick()},1e3*a.details.targetduration,this)),!a.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setSubtitleTrackInternal",value:function(a){var b,c;a>=0&&a<this.tracks.length&&(this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,i.logger.log("switching to subtitle track "+a),b=this.tracks[a],this.hls.trigger(f.default.SUBTITLE_TRACK_SWITCH,{id:a}),c=b.details,(void 0===c||c.live===!0)&&(i.logger.log("(re)loading playlist for subtitle track "+a),this.hls.trigger(f.default.SUBTITLE_TRACK_LOADING,{url:b.url,id:a})))}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(a){this.trackId!==a&&this.setSubtitleTrackInternal(a)}}]),b}(h.default),c.default=o},{34:34,35:35,54:54}],16:[function(a,b,c){"use strict";function n(a){return a&&a.__esModule?a:{"default":a}}function o(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function p(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function q(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}function s(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function t(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}var d,e,f,g,h,i,j,k,l,m,u;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=n(e),g=a(34),h=n(g),i=a(49),j=n(i),k=a(58),l=n(k),m=a(54),u=function(a){function b(a){var c,d,e,g,h;return o(this,b),c=p(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.MEDIA_ATTACHING,f.default.MEDIA_DETACHING,f.default.FRAG_PARSING_USERDATA,f.default.MANIFEST_LOADING,f.default.MANIFEST_LOADED,f.default.FRAG_LOADED,f.default.LEVEL_SWITCHING,f.default.INIT_PTS_FOUND)),c.hls=a,c.config=a.config,c.enabled=!0,c.Cues=a.config.cueHandler,c.textTracks=[],c.tracks=[],c.unparsedVttFrags=[],c.initPTS=void 0,c.cueRanges=[],c.config.enableCEA708Captions&&(d=c,e=function(a,b){var c=null;try{c=new window.Event("addtrack")}catch(d){c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)},g={newCue:function(a,b,c){var f,g;d.textTrack1||(f=d.getExistingTrack("1"),f?(d.textTrack1=f,r(d.textTrack1),e(d.textTrack1,d.media)):(g=d.createTextTrack("captions",d.config.captionsTextTrack1Label,d.config.captionsTextTrack1LanguageCode),g&&(g.textTrack1=!0,d.textTrack1=g))),d.addCues("textTrack1",a,b,c)
}},h={newCue:function(a,b,c){var f,g;d.textTrack2||(f=d.getExistingTrack("2"),f?(d.textTrack2=f,r(d.textTrack2),e(d.textTrack2,d.media)):(g=d.createTextTrack("captions",d.config.captionsTextTrack2Label,d.config.captionsTextTrack1LanguageCode),g&&(g.textTrack2=!0,d.textTrack2=g))),d.addCues("textTrack2",a,b,c)}},c.cea608Parser=new j.default(0,g,h)),c}return q(b,a),d(b,[{key:"addCues",value:function(a,b,c,d){var g,h,i,e=this.cueRanges,f=!1;for(g=e.length;g--;)if(h=e[g],i=t(h[0],h[1],b,c),i>=0&&(h[0]=Math.min(h[0],b),h[1]=Math.max(h[1],c),f=!0,i/(c-b)>.5))return;f||e.push([b,c]),this.Cues.newCue(this[a],b,c,d)}},{key:"onInitPtsFound",value:function(a){var b=this;"undefined"==typeof this.initPTS&&(this.initPTS=a.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(a){b.onFragLoaded(a)}),this.unparsedVttFrags=[])}},{key:"getExistingTrack",value:function(a){var c,d,e,b=this.media;if(b)for(c=0;c<b.textTracks.length;c++)if(d=b.textTracks[c],e="textTrack"+a,d[e]===!0)return d;return null}},{key:"createTextTrack",value:function(a,b,c){var d=this.media;return d?d.addTextTrack(a,b,c):void 0}},{key:"destroy",value:function(){h.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(a){this.media=a.media}},{key:"onMediaDetaching",value:function(){r(this.textTrack1),r(this.textTrack2)}},{key:"onManifestLoading",value:function(){var a,b,c;if(this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},a=this.media,a&&(b=a.textTracks))for(c=0;c<b.length;c++)r(b[c])}},{key:"onManifestLoaded",value:function(a){var c,b=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT&&(this.tracks=a.subtitles||[],c=this.media?this.media.textTracks:[],this.tracks.forEach(function(a,d){var f,e=void 0;d<c.length&&(f=c[d],s(f,a)&&(e=f)),e||(e=b.createTextTrack("subtitles",a.name,a.lang)),e.mode=a.default?"showing":"hidden",b.textTracks.push(e)}))}},{key:"onLevelSwitching",value:function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function(a){var d,e,g,h,i,b=a.frag,c=a.payload;if("main"===b.type)d=b.sn,d!==this.lastSn+1&&(e=this.cea608Parser,e&&e.reset()),this.lastSn=d;else if("subtitle"===b.type)if(c.byteLength){if("undefined"==typeof this.initPTS)return this.unparsedVttFrags.push(a),void 0;g=this.vttCCs,g[b.cc]||(g[b.cc]={start:b.start,prevCC:this.prevCC,"new":!0},this.prevCC=b.cc),h=this.textTracks,i=this.hls,l.default.parse(c,this.initPTS,g,b.cc,function(a){var c=h[b.trackId];a.forEach(function(a){if(!c.cues.getCueById(a.id))try{c.addCue(a)}catch(b){var d=new window.TextTrackCue(a.startTime,a.endTime,a.text);d.id=a.id,c.addCue(d)}}),i.trigger(f.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:b})},function(a){m.logger.log("Failed to parse VTT cue: "+a),i.trigger(f.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b})})}else this.hls.trigger(f.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:b})}},{key:"onFragParsingUserdata",value:function(a){var b,c;if(this.enabled&&this.config.enableCEA708Captions)for(b=0;b<a.samples.length;b++)c=this.extractCea608Data(a.samples[b].bytes),this.cea608Parser.addData(a.samples[b].pts,c)}},{key:"extractCea608Data",value:function(a){var d,e,f,g,h,j,b=31&a[0],c=2,i=[];for(j=0;b>j;j++)d=a[c++],e=127&a[c++],f=127&a[c++],g=0!==(4&d),h=3&d,(0!==e||0!==f)&&g&&0===h&&(i.push(e),i.push(f));return i}}]),b}(h.default),c.default=u},{34:34,35:35,49:49,54:54,58:58}],17:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,f;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){e(this,a),this.subtle=b,this.aesIV=c}return d(a,[{key:"decrypt",value:function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)}}]),a}(),c.default=f},{}],18:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,f;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){e(this,a),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return d(a,[{key:"uint8ArrayToUint32Array_",value:function(a){var d,b=new DataView(a),c=new Uint32Array(4);for(d=0;4>d;d++)try{c[d]=b.getUint32(4*d)}catch(e){}return c}},{key:"initTable",value:function(){var q,r,s,t,u,a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;for(p=0;256>p;p++)m[p]=128>p?p<<1:283^p<<1;for(p=0;256>p;p++)q=o^o<<1^o<<2^o<<3^o<<4,q=99^(q>>>8^255&q),a[n]=q,b[q]=n,r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q,d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}},{key:"expandKey",value:function(a){for(var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){if(this.key=b,e=this.keySize=b.length,4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);for(f=this.ksRows=4*(e+6+1),g=void 0,h=void 0,i=this.keySchedule=new Uint32Array(f),j=this.invKeySchedule=new Uint32Array(f),k=this.sBox,l=this.rcon,m=this.invSubMix,n=m[0],o=m[1],p=m[2],q=m[3],r=void 0,s=void 0,g=0;f>g;g++)e>g?r=i[g]=b[g]:(s=r,0===g%e?(s=s<<8|s>>>24,s=k[s>>>24]<<24|k[255&s>>>16]<<16|k[255&s>>>8]<<8|k[255&s],s^=l[0|g/e]<<24):e>6&&4===g%e&&(s=k[s>>>24]<<24|k[255&s>>>16]<<16|k[255&s>>>8]<<8|k[255&s]),i[g]=r=(i[g-e]^s)>>>0);for(h=0;f>h;h++)g=f-h,s=3&h?i[g]:i[g-4],j[h]=4>h||4>=g?s:n[k[s>>>24]]^o[k[255&s>>>16]]^p[k[255&s>>>8]]^q[k[255&s]],j[h]=j[h]>>>0}}},{key:"networkToHostOrderSwap",value:function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24}},{key:"decrypt",value:function(a,b,c){for(var E,F,d=this.keySize+6,e=this.invKeySchedule,f=this.invSBox,g=this.invSubMix,h=g[0],i=g[1],j=g[2],k=g[3],l=this.uint8ArrayToUint32Array_(c),m=l[0],n=l[1],o=l[2],p=l[3],q=new Int32Array(a),r=new Int32Array(q.length),s=void 0,t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,G=this.networkToHostOrderSwap;b<q.length;){for(A=G(q[b]),B=G(q[b+1]),C=G(q[b+2]),D=G(q[b+3]),w=A^e[0],x=D^e[1],y=C^e[2],z=B^e[3],E=4,F=1;d>F;F++)s=h[w>>>24]^i[255&x>>16]^j[255&y>>8]^k[255&z]^e[E],t=h[x>>>24]^i[255&y>>16]^j[255&z>>8]^k[255&w]^e[E+1],u=h[y>>>24]^i[255&z>>16]^j[255&w>>8]^k[255&x]^e[E+2],v=h[z>>>24]^i[255&w>>16]^j[255&x>>8]^k[255&y]^e[E+3],w=s,x=t,y=u,z=v,E+=4;s=f[w>>>24]<<24^f[255&x>>16]<<16^f[255&y>>8]<<8^f[255&z]^e[E],t=f[x>>>24]<<24^f[255&y>>16]<<16^f[255&z>>8]<<8^f[255&w]^e[E+1],u=f[y>>>24]<<24^f[255&z>>16]<<16^f[255&w>>8]<<8^f[255&x]^e[E+2],v=f[z>>>24]<<24^f[255&w>>16]<<16^f[255&x>>8]<<8^f[255&y]^e[E+3],E+=3,r[b]=G(s^m),r[b+1]=G(v^n),r[b+2]=G(u^o),r[b+3]=G(t^p),m=A,n=B,o=C,p=D,b+=4}return r.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),a}(),c.default=f},{}],19:[function(a,b,c){"use strict";function m(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,o;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(17),f=m(e),g=a(20),h=m(g),i=a(18),j=m(i),k=a(33),l=a(54),o=function(){function a(b,c){n(this,a),this.observer=b,this.config=c,this.logEnabled=!0;try{var d=crypto?crypto:self.crypto;this.subtle=d.subtle||d.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return d(a,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(a,b,c,d){var g,i,e=this;this.disableWebCrypto&&this.config.enableSoftwareAES?(this.logEnabled&&(l.logger.log("JS AES decrypt"),this.logEnabled=!1),g=this.decryptor,g||(this.decryptor=g=new j.default),g.expandKey(b),d(g.decrypt(a,0,c))):(this.logEnabled&&(l.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1),i=this.subtle,this.key!==b&&(this.key=b,this.fastAesKey=new h.default(i,b)),this.fastAesKey.expandKey().then(function(g){var h=new f.default(i,c);h.decrypt(a,g).catch(function(f){e.onWebCryptoError(f,a,b,c,d)}).then(function(a){d(a)})}).catch(function(f){e.onWebCryptoError(f,a,b,c,d)}))}},{key:"onWebCryptoError",value:function(a,b,c,d,e){this.config.enableSoftwareAES?(l.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(b,c,d,e)):(l.logger.error("decrypting error : "+a.message),this.observer.trigger(Event.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))}},{key:"destroy",value:function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)}}]),a}(),c.default=o},{17:17,18:18,20:20,33:33,54:54}],20:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,f;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){e(this,a),this.subtle=b,this.key=c}return d(a,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),a}(),c.default=f},{}],21:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,l;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(22),f=j(e),g=a(54),h=a(27),i=j(h),l=function(){function a(b,c,d){k(this,a),this.observer=b,this.config=d,this.remuxer=c}return d(a,[{key:"resetInitSegment",value:function(a,b,c,d){this._audioTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(a,b,c,d){for(var p,e=this._audioTrack,h=i.default.getID3Data(a,0),j=90*i.default.getTimeStamp(h),k=0,l=j,m=a.length,n=h.length,o=[{pts:l,dts:l,data:h}];m-1>n;)if(f.default.isHeader(a,n)&&m>n+5){if(f.default.initTrackConfig(e,this.observer,a,n,e.manifestCodec),p=f.default.appendFrame(e,a,n,j,k),!p){g.logger.log("Unable to parse AAC frame");break}n+=p.length,l=p.sample.pts,k++}else i.default.isHeader(a,n)?(h=i.default.getID3Data(a,n),o.push({pts:l,dts:l,data:h}),n+=h.length):n++;this.remuxer.remux(e,{samples:[]},{samples:o,inputTimeScale:9e4},{samples:[]},b,c,d)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(a){var b,c,d=i.default.getID3Data(a,0);if(d&&void 0!==i.default.getTimeStamp(d))for(b=d.length,c=Math.min(a.length-1,b+100);c>b;b++)if(f.default.probe(a,b))return g.logger.log("ADTS sync word found !"),!0;return!1}}]),a}(),c.default=l},{22:22,27:27,54:54}],22:[function(a,b){"use strict";var d=a(54),e=a(33),f={getAudioConfig:function(a,b,c,f){var g,h,i,j,k,l=navigator.userAgent.toLowerCase(),m=f,n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return g=((192&b[c+2])>>>6)+1,h=(60&b[c+2])>>>2,h>n.length-1?(a.trigger(Event.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h}),void 0):(j=(1&b[c+2])<<2,j|=(192&b[c+3])>>>6,d.logger.log("manifest codec:"+f+",ADTS data:type:"+g+",sampleingIndex:"+h+"["+n[h]+"Hz],channelConfig:"+j),/firefox/i.test(l)?h>=6?(g=5,k=new Array(4),i=h-3):(g=2,k=new Array(2),i=h):-1!==l.indexOf("android")?(g=2,k=new Array(2),i=h):(g=5,k=new Array(4),f&&(-1!==f.indexOf("mp4a.40.29")||-1!==f.indexOf("mp4a.40.5"))||!f&&h>=6?i=h-3:((f&&-1!==f.indexOf("mp4a.40.2")&&(h>=6&&1===j||/vivaldi/i.test(l))||!f&&1===j)&&(g=2,k=new Array(2)),i=h)),k[0]=g<<3,k[0]|=(14&h)>>1,k[1]|=(1&h)<<7,k[1]|=j<<3,5===g&&(k[1]|=(14&i)>>1,k[2]=(1&i)<<7,k[2]|=8,k[3]=0),{config:k,samplerate:n[h],channelCount:j,codec:"mp4a.40."+g,manifestCodec:m})},isHeaderPattern:function(a,b){return 255===a[b]&&240===(246&a[b+1])},getHeaderLength:function(a,b){return 1&a[b+1]?7:9},getFullFrameLength:function(a,b){return(3&a[b+3])<<11|a[b+4]<<3|(224&a[b+5])>>>5},isHeader:function(a,b){return b+1<a.length&&this.isHeaderPattern(a,b)?!0:!1},probe:function(a,b){var c,d,e;return b+1<a.length&&this.isHeaderPattern(a,b)&&(c=this.getHeaderLength(a,b),d=c,b+5<a.length&&(d=this.getFullFrameLength(a,b)),e=b+d,e===a.length||e+1<a.length&&this.isHeaderPattern(a,e))?!0:!1},initTrackConfig:function(a,b,c,e,f){if(!a.samplerate){var g=this.getAudioConfig(b,c,e,f);a.config=g.config,a.samplerate=g.samplerate,a.channelCount=g.channelCount,a.codec=g.codec,a.manifestCodec=g.manifestCodec,d.logger.log("parsed codec:"+a.codec+",rate:"+g.samplerate+",nb channel:"+g.channelCount)}},getFrameDuration:function(a){return 9216e4/a},appendFrame:function(a,b,c,d,e){var h,i,j,k,f=this.getFrameDuration(a.samplerate),g=this.parseFrameHeader(b,c,d,e,f);return g?(h=g.stamp,i=g.headerLength,j=g.frameLength,k={unit:b.subarray(c+i,c+i+j),pts:h,dts:h},a.samples.push(k),a.len+=j,{sample:k,length:j+i}):void 0},parseFrameHeader:function(a,b,c,d,e){var h,i=a.length,f=this.getHeaderLength(a,b),g=this.getFullFrameLength(a,b);return g-=f,g>0&&i>=b+f+g?(h=c+d*e,{headerLength:f,frameLength:g,stamp:h}):void 0}};b.exports=f},{33:33,54:54}],23:[function(a,b,c){"use strict";function v(a){return a&&a.__esModule?a:{"default":a}}function w(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,x;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=v(e),g=a(33),h=a(19),i=v(h),j=a(21),k=v(j),l=a(29),m=v(l),n=a(32),o=v(n),p=a(28),q=v(p),r=a(45),s=v(r),t=a(46),u=v(t),x=function(){function a(b,c,d,e){w(this,a),this.observer=b,this.typeSupported=c,this.config=d,this.vendor=e}return d(a,[{key:"destroy",value:function(){var a=this.demuxer;a&&a.destroy()}},{key:"push",value:function(a,b,c,d,e,g,h,j,k,l,m,n){var o,p,q;if(a.byteLength>0&&null!=b&&null!=b.key&&"AES-128"===b.method){o=this.decrypter,null==o&&(o=this.decrypter=new i.default(this.observer,this.config)),p=this;try{q=performance.now()}catch(r){q=Date.now()}o.decrypt(a,b.key.buffer,b.iv.buffer,function(a){var i;try{i=performance.now()}catch(o){i=Date.now()}p.observer.trigger(f.default.FRAG_DECRYPTED,{stats:{tstart:q,tdecrypt:i}}),p.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,g,h,j,k,l,m,n)})}else this.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),d,e,g,h,j,k,l,m,n)}},{key:"pushDecrypted",value:function(a,b,c,d,e,h,i,j,l,n,p,r){var v,w,x,y,z,A,B,C,D,E,t=this.demuxer;if(!t||i&&!this.probe(a)){for(v=this.observer,w=this.typeSupported,x=this.config,y=[{demux:k.default,remux:s.default},{demux:q.default,remux:s.default},{demux:o.default,remux:s.default},{demux:m.default,remux:u.default}],z=0,A=y.length;A>z;z++)if(B=y[z],C=B.demux.probe,C(a)){D=this.remuxer=new B.remux(v,x,w,this.vendor),t=new B.demux(v,D,x,w),this.probe=C;break}if(!t)return v.trigger(f.default.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),void 0;this.demuxer=t}E=this.remuxer,(i||j)&&(t.resetInitSegment(c,d,e,n),E.resetInitSegment()),i&&(t.resetTimeStamp(r),E.resetTimeStamp(r)),"function"==typeof t.setDecryptData&&t.setDecryptData(b),t.append(a,h,l,p)}}]),a}(),c.default=x},{19:19,21:21,28:28,29:29,32:32,33:33,35:35,45:45,46:46}],24:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{"default":a}}var d,e,f,g,h,i,j,l;Object.defineProperty(c,"__esModule",{value:!0}),d=a(23),e=k(d),f=a(35),g=k(f),h=a(54),i=a(1),j=k(i),l=function(a){var c,b=new j.default;b.trigger=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];b.emit.apply(b,[a,a].concat(d))},b.off=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];b.removeListener.apply(b,[a].concat(d))},c=function(b,c){a.postMessage({event:b,data:c})},a.addEventListener("message",function(d){var g,f=d.data;switch(f.cmd){case"init":g=JSON.parse(f.config),a.demuxer=new e.default(b,f.typeSupported,g,f.vendor);try{h.enableLogs(g.debug===!0)}catch(i){console.warn("demuxerWorker: unable to enable logs")}c("init",null);break;case"demux":a.demuxer.push(f.data,f.decryptdata,f.initSegment,f.audioCodec,f.videoCodec,f.timeOffset,f.discontinuity,f.trackSwitch,f.contiguous,f.duration,f.accurateTimeOffset,f.defaultInitPTS)}}),b.on(g.default.FRAG_DECRYPTED,c),b.on(g.default.FRAG_PARSING_INIT_SEGMENT,c),b.on(g.default.FRAG_PARSED,c),b.on(g.default.ERROR,c),b.on(g.default.FRAG_PARSING_METADATA,c),b.on(g.default.FRAG_PARSING_USERDATA,c),b.on(g.default.INIT_PTS_FOUND,c),b.on(g.default.FRAG_PARSING_DATA,function(b,c){var d=[],e={event:b,data:c};c.data1&&(e.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1),c.data2&&(e.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2),a.postMessage(e,d)})},c.default=l},{1:1,23:23,35:35,54:54}],25:[function(a,b,c){"use strict";function o(a){return a&&a.__esModule?a:{"default":a}}function p(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n,q;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=o(e),g=a(23),h=o(g),i=a(24),j=o(i),k=a(54),l=a(33),m=a(1),n=o(m),q=function(){function b(c,d){var e,g,i,m,o,q,r;if(p(this,b),this.hls=c,this.id=d,e=this.observer=new n.default,g=c.config,e.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];e.emit.apply(e,[a,a].concat(c))},e.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];e.removeListener.apply(e,[a].concat(c))},i=function(a,b){b=b||{},b.frag=this.frag,b.id=this.id,c.trigger(a,b)}.bind(this),e.on(f.default.FRAG_DECRYPTED,i),e.on(f.default.FRAG_PARSING_INIT_SEGMENT,i),e.on(f.default.FRAG_PARSING_DATA,i),e.on(f.default.FRAG_PARSED,i),e.on(f.default.ERROR,i),e.on(f.default.FRAG_PARSING_METADATA,i),e.on(f.default.FRAG_PARSING_USERDATA,i),e.on(f.default.INIT_PTS_FOUND,i),m={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor,g.enableWorker&&"undefined"!=typeof Worker){k.logger.log("demuxing in webworker"),q=void 0;try{r=a(3),q=this.w=r(j.default),this.onwmsg=this.onWorkerMessage.bind(this),q.addEventListener("message",this.onwmsg),q.onerror=function(a){c.trigger(f.default.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:a.message+" ("+a.filename+":"+a.lineno+")"}})},q.postMessage({cmd:"init",typeSupported:m,vendor:o,id:d,config:JSON.stringify(g)})}catch(s){k.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),q&&URL.revokeObjectURL(q.objectURL),this.demuxer=new h.default(e,m,g,o),this.w=void 0}}else this.demuxer=new h.default(e,m,g,o)}return d(b,[{key:"destroy",value:function(){var b,c,a=this.w;a?(a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null):(b=this.demuxer,b&&(b.destroy(),this.demuxer=null)),c=this.observer,c&&(c.removeAllListeners(),this.observer=null)}},{key:"push",value:function(a,b,c,d,e,f,g,h){var r,i=this.w,j=isNaN(e.startDTS)?e.start:e.startDTS,l=e.decryptdata,m=this.frag,n=!(m&&e.cc===m.cc),o=!(m&&e.level===m.level),p=m&&e.sn===m.sn+1,q=!o&&p;n&&k.logger.log(this.id+":discontinuity detected"),o&&k.logger.log(this.id+":switch detected"),this.frag=e,i?i.postMessage({cmd:"demux",data:a,decryptdata:l,initSegment:b,audioCodec:c,videoCodec:d,timeOffset:j,discontinuity:n,trackSwitch:o,contiguous:q,duration:f,accurateTimeOffset:g,defaultInitPTS:h},[a]):(r=this.demuxer,r&&r.push(a,l,b,c,d,j,n,o,q,f,g,h))}},{key:"onWorkerMessage",value:function(a){var b=a.data,c=this.hls;switch(b.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case f.default.FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data2&&(b.data.data2=new Uint8Array(b.data2));default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}}}]),b}(),c.default=q},{1:1,23:23,24:24,3:3,33:33,35:35,54:54}],26:[function(a,b,c){"use strict";function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,g;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(54),g=function(){function a(b){f(this,a),this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}return d(a,[{key:"loadWord",value:function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e}},{key:"skipBits",value:function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)}},{key:"readBits",value:function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&e.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c}},{key:"skipLZ",value:function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!==(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var a=this.skipLZ();return this.readBits(a+1)-1}},{key:"readEG",value:function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(a){var d,e,b=8,c=8;for(d=0;a>d;d++)0!==c&&(e=this.readEG(),c=(b+e+256)%256),b=0===c?b:c}},{key:"readSPS",value:function(){var e,f,g,h,i,j,k,l,m,v,w,x,y,a=0,b=0,c=0,d=0,n=this.readUByte.bind(this),o=this.readBits.bind(this),p=this.readUEG.bind(this),q=this.readBoolean.bind(this),r=this.skipBits.bind(this),s=this.skipEG.bind(this),t=this.skipUEG.bind(this),u=this.skipScalingList.bind(this);if(n(),e=n(),f=o(5),r(3),g=n(),t(),(100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e)&&(v=p(),3===v&&r(1),t(),t(),r(1),q()))for(l=3!==v?8:12,m=0;l>m;m++)q()&&(6>m?u(16):u(64));if(t(),w=p(),0===w)p();else if(1===w)for(r(1),s(),s(),h=p(),m=0;h>m;m++)s();if(t(),r(1),i=p(),j=p(),k=o(1),0===k&&r(1),r(1),q()&&(a=p(),b=p(),c=p(),d=p()),x=[1,1],q()&&q())switch(y=n()){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[n()<<8|n(),n()<<8|n()]}return{width:Math.ceil(16*(i+1)-2*a-2*b),height:16*(2-k)*(j+1)-(k?2:4)*(c+d),pixelRatio:x}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),a}(),c.default=g},{54:54}],27:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,f;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){e(this,a)}return d(a,null,[{key:"isHeader",value:function(a,b){return b+10<=a.length&&73===a[b]&&68===a[b+1]&&51===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128?!0:!1}},{key:"isFooter",value:function(a,b){return b+10<=a.length&&51===a[b]&&68===a[b+1]&&73===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128?!0:!1}},{key:"getID3Data",value:function(b,c){for(var f,d=c,e=0;a.isHeader(b,c);)e+=10,f=a._readSize(b,c+6),e+=f,a.isFooter(b,c+10)&&(e+=10),c+=e;return e>0?b.subarray(d,d+e):void 0}},{key:"_readSize",value:function(a,b){var c=0;return c=(127&a[b])<<21,c|=(127&a[b+1])<<14,c|=(127&a[b+2])<<7,c|=127&a[b+3]}},{key:"getTimeStamp",value:function(b){var d,e,c=a.getID3Frames(b);for(d=0;d<c.length;d++)if(e=c[d],a.isTimeStampFrame(e))return a._readTimeStamp(e);return void 0}},{key:"isTimeStampFrame",value:function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info}},{key:"_getFrameData",value:function(b){var c=String.fromCharCode(b[0],b[1],b[2],b[3]),d=a._readSize(b,4),e=10;return{type:c,size:d,data:b.subarray(e,e+d)}}},{key:"getID3Frames",value:function(b){for(var e,f,g,h,c=0,d=[];a.isHeader(b,c);){for(e=a._readSize(b,c+6),c+=10,f=c+e;f>c+8;)g=a._getFrameData(b.subarray(c)),h=a._decodeFrame(g),h&&d.push(h),c+=g.size+10;a.isFooter(b,c)&&(c+=10)}return d}},{key:"_decodeFrame",value:function(b){return"PRIV"===b.type?a._decodePrivFrame(b):"T"===b.type[0]?a._decodeTextFrame(b):"W"===b.type[0]?a._decodeURLFrame(b):void 0}},{key:"_readTimeStamp",value:function(a){var b,c,d;return 8===a.data.byteLength?(b=new Uint8Array(a.data),c=1&b[3],d=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7],d/=45,c&&(d+=47721858.84),Math.round(d)):void 0}},{key:"_decodePrivFrame",value:function(b){var c,d;return b.size<2?void 0:(c=a._utf8ArrayToStr(b.data),d=new Uint8Array(b.data.subarray(c.length+1)),{key:b.type,info:c,data:d.buffer})}},{key:"_decodeTextFrame",value:function(b){var c,d,e,f;return b.size<2?void 0:"TXXX"===b.type?(c=1,d=a._utf8ArrayToStr(b.data.subarray(c)),c+=d.length+1,e=a._utf8ArrayToStr(b.data.subarray(c)),{key:b.type,info:d,data:e}):(f=a._utf8ArrayToStr(b.data.subarray(1)),{key:b.type,data:f})}},{key:"_decodeURLFrame",value:function(b){var c,d,e,f;return"WXXX"===b.type?b.size<2?void 0:(c=1,d=a._utf8ArrayToStr(b.data.subarray(c)),c+=d.length+1,e=a._utf8ArrayToStr(b.data.subarray(c)),{key:b.type,info:d,data:e}):(f=a._utf8ArrayToStr(b.data),{key:b.type,data:f})}},{key:"_utf8ArrayToStr",value:function(a){for(var g,b=void 0,c=void 0,d="",e=0,f=a.length;f>e;)switch(g=a[e++],g>>4){case 0:return d;case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(g);break;case 12:case 13:b=a[e++],d+=String.fromCharCode((31&g)<<6|63&b);break;case 14:b=a[e++],c=a[e++],d+=String.fromCharCode((15&g)<<12|(63&b)<<6|(63&c)<<0)}return d}}]),a}(),c.default=f},{}],28:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,l;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(27),f=j(e),g=a(54),h=a(30),i=j(h),l=function(){function a(b,c,d){k(this,a),this.observer=b,this.config=d,this.remuxer=c}return d(a,[{key:"resetInitSegment",value:function(a,b,c,d){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(a,b,c,d){for(var o,e=f.default.getID3Data(a,0),g=90*f.default.getTimeStamp(e),h=e.length,j=a.length,k=0,l=0,m=this._audioTrack,n=[{pts:g,dts:g,data:e}];j>h;)if(i.default.isHeader(a,h)){if(o=i.default.appendFrame(m,a,h,g,k),!o)break;h+=o.length,l=o.sample.pts,k++}else f.default.isHeader(a,h)?(e=f.default.getID3Data(a,h),n.push({pts:l,dts:l,data:e}),h+=e.length):h++;this.remuxer.remux(m,{samples:[]},{samples:n,inputTimeScale:9e4},{samples:[]},b,c,d)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(a){var b,c,d=f.default.getID3Data(a,0);if(d&&void 0!==f.default.getTimeStamp(d))for(b=d.length,c=Math.min(a.length-1,b+100);c>b;b++)if(i.default.probe(a,b))return g.logger.log("MPEG Audio sync word found !"),!0;return!1}}]),a}(),c.default=l},{27:27,30:30,54:54}],29:[function(a,b,c){"use strict";function g(a){return a&&a.__esModule?a:{"default":a}}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,i,j;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=g(e),i=Math.pow(2,32)-1,j=function(){function a(b,c){h(this,a),this.observer=b,this.remuxer=c}return d(a,[{key:"resetTimeStamp",value:function(a){this.initPTS=a}},{key:"resetInitSegment",value:function(b,c,d,e){var g,h;b&&b.byteLength?(g=this.initData=a.parseInitSegment(b),h={},g.audio&&(h.audio={container:"audio/mp4",codec:c,initSegment:e?b:null}),g.video&&(h.video={container:"video/mp4",codec:d,initSegment:e?b:null}),this.observer.trigger(f.default.FRAG_PARSING_INIT_SEGMENT,{tracks:h})):(c&&(this.audioCodec=c),d&&(this.videoCodec=d))}},{key:"append",value:function(b,c,d,e){var h,i,j,g=this.initData;g||(this.resetInitSegment(b,this.audioCodec,this.videoCodec),g=this.initData),h=void 0,i=this.initPTS,void 0===i&&(j=a.getStartDTS(g,b),this.initPTS=i=j-c,this.observer.trigger(f.default.INIT_PTS_FOUND,{initPTS:i})),a.offsetStartDTS(g,b,i),h=a.getStartDTS(g,b),this.remuxer.remux(g.audio,g.video,null,null,h,d,e,b)
}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(b){if(b.length>=8){var c=a.bin2str(b.subarray(4,8));return["moof","ftyp","styp"].indexOf(c)>=0}return!1}},{key:"bin2str",value:function(a){return String.fromCharCode.apply(null,a)}},{key:"readUint32",value:function(a,b){a.data&&(b+=a.start,a=a.data);var c=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return 0>c?4294967296+c:c}},{key:"writeUint32",value:function(a,b,c){a.data&&(b+=a.start,a=a.data),a[b]=c>>24,a[b+1]=255&c>>16,a[b+2]=255&c>>8,a[b+3]=255&c}},{key:"findBox",value:function(b,c){var e,f,g,h,i,j,k,d=[];if(b.data?(j=b.start,h=b.end,b=b.data):(j=0,h=b.byteLength),!c.length)return null;for(e=j;h>e;)f=a.readUint32(b,e),g=a.bin2str(b.subarray(e+4,e+8)),k=f>1?e+f:h,g===c[0]&&(1===c.length?d.push({data:b,start:e+8,end:k}):(i=a.findBox({data:b,start:e+8,end:k},c.slice(1)),i.length&&(d=d.concat(i)))),e=k;return d}},{key:"parseInitSegment",value:function(b){var c=[],d=a.findBox(b,["moov","trak"]);return d.forEach(function(b){var e,f,g,h,i,j,k,l,d=a.findBox(b,["tkhd"])[0];d&&(e=d.data[d.start],f=0===e?12:20,g=a.readUint32(d,f),h=a.findBox(b,["mdia","mdhd"])[0],h&&(e=h.data[h.start],f=0===e?12:20,i=a.readUint32(h,f),j=a.findBox(b,["mdia","hdlr"])[0],j&&(k=a.bin2str(j.data.subarray(j.start+8,j.start+12)),l={soun:"audio",vide:"video"}[k],l&&(c[g]={timescale:i,type:l},c[l]={timescale:i,id:g}))))}),c}},{key:"getStartDTS",value:function(b,c){var d,e,f;return d=a.findBox(c,["moof","traf"]),e=[].concat.apply([],d.map(function(c){return a.findBox(c,["tfhd"]).map(function(d){var e,f,g;return e=a.readUint32(d,4),f=b[e].timescale||9e4,g=a.findBox(c,["tfdt"]).map(function(b){var c,d;return c=b.data[b.start],d=a.readUint32(b,4),1===c&&(d*=Math.pow(2,32),d+=a.readUint32(b,8)),d})[0],g=g||1/0,g/f})})),f=Math.min.apply(null,e),isFinite(f)?f:0}},{key:"offsetStartDTS",value:function(b,c,d){a.findBox(c,["moof","traf"]).map(function(c){return a.findBox(c,["tfhd"]).map(function(e){var f=a.readUint32(e,4),g=b[f].timescale||9e4;a.findBox(c,["tfdt"]).map(function(b){var f,h,c=b.data[b.start],e=a.readUint32(b,4);0===c?a.writeUint32(b,4,e-d*g):(e*=Math.pow(2,32),e+=a.readUint32(b,8),e-=d*g,f=Math.floor(e/(i+1)),h=Math.floor(e%(i+1)),a.writeUint32(b,4,f),a.writeUint32(b,8,h))})})})}}]),a}(),c.default=j},{35:35}],30:[function(a,b){"use strict";var d={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],appendFrame:function(a,b,c,d,e){var f,g,h,i;return c+24>b.length?void 0:(f=this.parseHeader(b,c),f&&c+f.frameLength<=b.length?(g=10368e4/f.sampleRate,h=d+e*g,i={unit:b.subarray(c,c+f.frameLength),pts:h,dts:h},a.config=[],a.channelCount=f.channelCount,a.samplerate=f.sampleRate,a.samples.push(i),a.len+=f.frameLength,{sample:i,length:f.frameLength}):void 0)},parseHeader:function(a,b){var i,j,k,l,m,n,o,c=3&a[b+1]>>3,e=3&a[b+1]>>1,f=15&a[b+2]>>4,g=3&a[b+2]>>2,h=!!(2&a[b+2]);return 1!==c&&0!==f&&15!==f&&3!==g?(i=3===c?3-e:3===e?3:4,j=1e3*d.BitratesMap[14*i+f-1],k=3===c?0:2===c?1:2,l=d.SamplingRateMap[3*k+g],m=h?1:0,n=3===a[b+3]>>6?1:2,o=3===e?(3===c?12:6)*j/l+m<<2:0|(3===c?144:72)*j/l+m,{sampleRate:l,channelCount:n,frameLength:o}):void 0},isHeaderPattern:function(a,b){return 255===a[b]&&224===(224&a[b+1])&&0!==(6&a[b+1])},isHeader:function(a,b){return b+1<a.length&&this.isHeaderPattern(a,b)?!0:!1},probe:function(a,b){var c,d,e,f;return b+1<a.length&&this.isHeaderPattern(a,b)&&(c=4,d=this.parseHeader(a,b),e=c,d&&d.frameLength&&(e=d.frameLength),f=b+e,f===a.length||f+1<a.length&&this.isHeaderPattern(a,f))?!0:!1}};b.exports=d},{}],31:[function(a,b,c){"use strict";function g(a){return a&&a.__esModule?a:{"default":a}}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,i;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(19),f=g(e),i=function(){function a(b,c,d,e){h(this,a),this.decryptdata=d,this.discardEPB=e,this.decrypter=new f.default(b,c)}return d(a,[{key:"decryptBuffer",value:function(a,b){this.decrypter.decrypt(a,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,b)}},{key:"decryptAacSample",value:function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){f=new Uint8Array(f),e.set(f,16),d||h.decryptAacSamples(a,b+1,c)})}},{key:"decryptAacSamples",value:function(a,b,c){for(;;b++){if(b>=a.length)return c(),void 0;if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}}},{key:"getAvcEncryptedData",value:function(a){var e,b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0;for(e=32;e<=a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c}},{key:"getAvcDecryptedUnit",value:function(a,b){var c,d;for(b=new Uint8Array(b),c=0,d=32;d<=a.length-16;d+=160,c+=16)a.set(b.subarray(c,c+16),d);return a}},{key:"decryptAvcSample",value:function(a,b,c,d,e,f){var g=this.discardEPB(e.data),h=this.getAvcEncryptedData(g),i=this;this.decryptBuffer(h.buffer,function(h){e.data=i.getAvcDecryptedUnit(g,h),f||i.decryptAvcSamples(a,b,c+1,d)})}},{key:"decryptAvcSamples",value:function(a,b,c,d){for(var e,f,g;;b++,c=0){if(b>=a.length)return d(),void 0;for(e=a[b].units;!(c>=e.length);c++)if(f=e[c],!(f.length<=48||1!==f.type&&5!==f.type||(g=this.decrypter.isSync(),this.decryptAvcSample(a,b,c,d,f,g),g)))return}}}]),a}(),c.default=i},{19:19}],32:[function(a,b,c){"use strict";function q(a){return a&&a.__esModule?a:{"default":a}}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n,o,p,s;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(22),f=q(e),g=a(30),h=q(g),i=a(35),j=q(i),k=a(26),l=q(k),m=a(31),n=q(m),o=a(54),p=a(33),s=function(){function a(b,c,d,e){r(this,a),this.observer=b,this.config=d,this.typeSupported=e,this.remuxer=c,this.sampleAes=null}return d(a,[{key:"setDecryptData",value:function(a){this.sampleAes=null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?new n.default(this.observer,this.config,a,this.discardEPB):null}},{key:"resetInitSegment",value:function(a,b,c,d){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,duration:d,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=b,this.videoCodec=c,this._duration=d}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(a,b,c,d){var e,g,h,i,j,k,m,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,f=a.length,l=!1;for(this.contiguous=c,m=this.pmtParsed,n=this._avcTrack,p=this._audioTrack,q=this._id3Track,r=n.id,s=p.id,t=q.id,u=this._pmtId,v=n.pesData,w=p.pesData,x=q.pesData,y=this._parsePAT,z=this._parsePMT,A=this._parsePES,B=this._parseAVCPES.bind(this),C=this._parseAACPES.bind(this),D=this._parseMPEGPES.bind(this),E=this._parseID3PES.bind(this),f-=f%188,e=0;f>e;e+=188)if(71===a[e]){if(g=!!(64&a[e+1]),h=((31&a[e+1])<<8)+a[e+2],i=(48&a[e+3])>>4,i>1){if(j=e+5+a[e+4],j===e+188)continue}else j=e+4;switch(h){case r:g&&(v&&(k=A(v))&&B(k,!1),v={data:[],size:0}),v&&(v.data.push(a.subarray(j,e+188)),v.size+=e+188-j);break;case s:g&&(w&&(k=A(w))&&(p.isAAC?C(k):D(k)),w={data:[],size:0}),w&&(w.data.push(a.subarray(j,e+188)),w.size+=e+188-j);break;case t:g&&(x&&(k=A(x))&&E(k),x={data:[],size:0}),x&&(x.data.push(a.subarray(j,e+188)),x.size+=e+188-j);break;case 0:g&&(j+=a[j]+1),u=this._pmtId=y(a,j);break;case u:g&&(j+=a[j]+1),F=z(a,j,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,null!=this.sampleAes),r=F.avc,r>0&&(n.id=r),s=F.audio,s>0&&(p.id=s,p.isAAC=F.isAAC),t=F.id3,t>0&&(q.id=t),l&&!m&&(o.logger.log("reparse from beginning"),l=!1,e=-188),m=this.pmtParsed=!0;break;case 17:case 8191:break;default:l=!0}}v&&(k=A(v))?(B(k,!0),n.pesData=null):n.pesData=v,w&&(k=A(w))?(p.isAAC?C(k):D(k),p.pesData=null):(w&&w.size&&o.logger.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=w),x&&(k=A(x))?(E(k),q.pesData=null):q.pesData=x,null==this.sampleAes?this.remuxer.remux(p,n,q,this._txtTrack,b,c,d):this.decryptAndRemux(p,n,q,this._txtTrack,b,c,d)}},{key:"decryptAndRemux",value:function(a,b,c,d,e,f,g){if(a.samples&&a.isAAC){var h=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){h.decryptAndRemuxAvc(a,b,c,d,e,f,g)})}else this.decryptAndRemuxAvc(a,b,c,d,e,f,g)}},{key:"decryptAndRemuxAvc",value:function(a,b,c,d,e,f,g){if(b.samples){var h=this;this.sampleAes.decryptAvcSamples(b.samples,0,0,function(){h.remuxer.remux(a,b,c,d,e,f,g)})}else this.remuxer.remux(a,b,c,d,e,f,g)}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(a,b){return(31&a[b+10])<<8|a[b+11]}},{key:"_parsePMT",value:function(a,b,c,d){var e,f,g,h,i={audio:-1,avc:-1,id3:-1,isAAC:!0};for(e=(15&a[b+1])<<8|a[b+2],f=b+3+e-4,g=(15&a[b+10])<<8|a[b+11],b+=12+g;f>b;){switch(h=(31&a[b+1])<<8|a[b+2],a[b]){case 207:if(!d){o.logger.log("unkown stream type:"+a[b]);break}case 15:-1===i.audio&&(i.audio=h);break;case 21:-1===i.id3&&(i.id3=h);break;case 219:if(!d){o.logger.log("unkown stream type:"+a[b]);break}case 27:-1===i.avc&&(i.avc=h);break;case 3:case 4:c?-1===i.audio&&(i.audio=h,i.isAAC=!1):o.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:o.logger.warn("HEVC stream type found, not supported for now");break;default:o.logger.log("unkown stream type:"+a[b])}b+=((15&a[b+3])<<8|a[b+4])+5}return i}},{key:"_parsePES",value:function(a){var c,d,e,f,g,h,i,j,k,m,n,p,q,b=0,l=a.data;if(!a||0===a.size)return null;for(;l[0].length<19&&l.length>1;)m=new Uint8Array(l[0].length+l[1].length),m.set(l[0]),m.set(l[1],l[0].length),l[0]=m,l.splice(1,1);if(c=l[0],e=(c[0]<<16)+(c[1]<<8)+c[2],1===e){if(f=(c[4]<<8)+c[5],f&&f>a.size-6)return null;for(d=c[7],192&d&&(i=536870912*(14&c[9])+4194304*(255&c[10])+16384*(254&c[11])+128*(255&c[12])+(254&c[13])/2,i>4294967295&&(i-=8589934592),64&d?(j=536870912*(14&c[14])+4194304*(255&c[15])+16384*(254&c[16])+128*(255&c[17])+(254&c[18])/2,j>4294967295&&(j-=8589934592),i-j>54e5&&(o.logger.warn(Math.round((i-j)/9e4)+"s delta between PTS and DTS, align them"),i=j)):j=i),g=c[8],k=g+9,a.size-=k,h=new Uint8Array(a.size),n=0,p=l.length;p>n;n++){if(c=l[n],q=c.byteLength,k){if(k>q){k-=q;continue}c=c.subarray(k),q-=k,k=0}h.set(c,b),b+=q}return f&&(f-=g+3),{data:h,pts:i,dts:j,len:f}}return null}},{key:"pushAccesUnit",value:function(a,b){var c,d;a.units.length&&a.frame&&(c=b.samples,d=c.length,!this.config.forceKeyFrameOnDiscontinuity||a.key===!0||b.sps&&(d||this.contiguous)?(a.id=d,c.push(a)):b.dropped++),a.debug.length&&o.logger.log(a.pts+"/"+a.dts+":"+a.debug)}},{key:"_parseAVCPES",value:function(a,b){var g,i,k,c=this,d=this._avcTrack,e=this._parseAVCNALu(a.data),f=!1,h=this.avcSample,j=!1,m=this.pushAccesUnit.bind(this),n=function(a,b,c,d){return{key:a,pts:b,dts:c,units:[],debug:d}};a.data=null,h&&e.length&&(m(h,d),h=this.avcSample=n(!1,a.pts,a.dts,"")),e.forEach(function(b){var e,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;switch(b.type){case 1:i=!0,f&&h&&(h.debug+="NDR "),h.frame=!0,e=b.data,j&&e.length>4&&(o=new l.default(e).readSliceType(),(2===o||4===o||7===o||9===o)&&(h.key=!0));break;case 5:i=!0,h||(h=c.avcSample=n(!0,a.pts,a.dts,"")),f&&(h.debug+="IDR "),h.key=!0,h.frame=!0;break;case 6:for(i=!0,f&&h&&(h.debug+="SEI "),g=new l.default(c.discardEPB(b.data)),g.readUByte(),p=0,q=0,r=!1,s=0;!r&&g.bytesAvailable>1;){p=0;do s=g.readUByte(),p+=s;while(255===s);q=0;do s=g.readUByte(),q+=s;while(255===s);if(4===p&&0!==g.bytesAvailable){if(r=!0,t=g.readUByte(),181===t&&(u=g.readUShort(),49===u&&(v=g.readUInt(),1195456820===v&&(w=g.readUByte(),3===w)))){for(x=g.readUByte(),y=g.readUByte(),z=31&x,A=[x,y],k=0;z>k;k++)A.push(g.readUByte()),A.push(g.readUByte()),A.push(g.readUByte());c._insertSampleInOrder(c._txtTrack.samples,{type:3,pts:a.pts,bytes:A})}}else if(q<g.bytesAvailable)for(k=0;q>k;k++)g.readUByte()}break;case 7:if(i=!0,j=!0,f&&h&&(h.debug+="SPS "),!d.sps){for(g=new l.default(b.data),B=g.readSPS(),d.width=B.width,d.height=B.height,d.pixelRatio=B.pixelRatio,d.sps=[b.data],d.duration=c._duration,C=b.data.subarray(1,4),D="avc1.",k=0;3>k;k++)E=C[k].toString(16),E.length<2&&(E="0"+E),D+=E;d.codec=D}break;case 8:i=!0,f&&h&&(h.debug+="PPS "),d.pps||(d.pps=[b.data]);break;case 9:i=!1,h&&m(h,d),h=c.avcSample=n(!1,a.pts,a.dts,f?"AUD ":"");break;case 12:i=!1;break;default:i=!1,h&&(h.debug+="unknown NAL "+b.type+" ")}h&&i&&(F=h.units,F.push(b))}),b&&h&&(m(h,d),this.avcSample=null)}},{key:"_insertSampleInOrder",value:function(a,b){var d,c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)}},{key:"_getLastNalUnit",value:function(){var c,d,e,a=this.avcSample,b=void 0;return a&&0!==a.units.length||(c=this._avcTrack,d=c.samples,a=d[d.length-1]),a&&(e=a.units,b=e[e.length-1]),b}},{key:"_parseAVCNALu",value:function(a){var d,e,j,k,m,n,o,p,q,b=0,c=a.byteLength,f=this._avcTrack,g=f.naluState||0,h=g,i=[],l=-1;for(-1===g&&(l=0,m=31&a[0],g=0,b=1);c>b;)d=a[b++],g?1!==g?d?1===d?(l>=0?(j={data:a.subarray(l,b-g-1),type:m},i.push(j)):(n=this._getLastNalUnit(),n&&(h&&4-h>=b&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-h)),e=b-g-1,e>0&&(o=new Uint8Array(n.data.byteLength+e),o.set(n.data,0),o.set(a.subarray(0,e),n.data.byteLength),n.data=o))),c>b?(k=31&a[b],l=b,m=k,g=0):g=-1):g=0:g=3:g=d?0:2:g=d?0:1;return l>=0&&g>=0&&(j={data:a.subarray(l,c),type:m,state:g},i.push(j)),0===i.length&&(p=this._getLastNalUnit(),p&&(q=new Uint8Array(p.data.byteLength+a.byteLength),q.set(p.data,0),q.set(a,p.data.byteLength),p.data=q)),f.naluState=g,i}},{key:"discardEPB",value:function(a){for(var e,f,g,b=a.byteLength,c=[],d=1;b-2>d;)0===a[d]&&0===a[d+1]&&3===a[d+2]?(c.push(d+2),d+=2):d++;if(0===c.length)return a;for(e=b-c.length,f=new Uint8Array(e),g=0,d=0;e>d;g++,d++)g===c[0]&&(g++,c.shift()),f[d]=a[g];return f}},{key:"_parseAACPES",value:function(a){var i,k,l,m,n,q,r,s,t,u,b=this._audioTrack,c=a.data,d=a.pts,e=0,g=this.aacOverFlow,h=this.aacLastPTS;for(g&&(q=new Uint8Array(g.byteLength+c.byteLength),q.set(g,0),q.set(c,g.byteLength),c=q),l=e,n=c.length;n-1>l&&!f.default.isHeader(c,l);l++);if(!l||(n-1>l?(r="AAC PES did not start with ADTS header,offset:"+l,s=!1):(r="no ADTS header found in AAC PES",s=!0),o.logger.warn("parsing error:"+r),this.observer.trigger(j.default.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:r}),!s)){for(f.default.initTrackConfig(b,this.observer,c,l,this.audioCodec),k=0,i=f.default.getFrameDuration(b.samplerate),g&&h&&(t=h+i,Math.abs(t-d)>1&&(o.logger.log("AAC: align PTS for overlapping frames by "+Math.round((t-d)/90)),d=t));n>l;)if(f.default.isHeader(c,l)&&n>l+5){if(u=f.default.appendFrame(b,c,l,d,k),!u)break;l+=u.length,m=u.sample.pts,k++}else l++;g=n>l?c.subarray(l,n):null,this.aacOverFlow=g,this.aacLastPTS=m}}},{key:"_parseMPEGPES",value:function(a){for(var g,b=a.data,c=b.length,d=0,e=0,f=a.pts;c>e;)if(h.default.isHeader(b,e)){if(g=h.default.appendFrame(this._audioTrack,b,e,f,d),!g)break;e+=g.length,d++}else e++}},{key:"_parseID3PES",value:function(a){this._id3Track.samples.push(a)}}],[{key:"probe",value:function(a){return a.length>=564&&71===a[0]&&71===a[188]&&71===a[376]?!0:!1}}]),a}(),c.default=s},{22:22,26:26,30:30,31:31,33:33,35:35,54:54}],33:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},c.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],34:[function(a,b,c){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}function k(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,l;Object.defineProperty(c,"__esModule",{value:!0}),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(54),g=a(33),h=a(35),i=j(h),l=function(){function a(b){k(this,a),this.hls=b,this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;c>e;e++)d[e-1]=arguments[e];this.handledEvents=d,this.useGenericHandler=!0,this.registerListeners()}return e(a,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===d(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if("hlsEventGeneric"===a)throw new Error("Forbidden event name: "+a);this.hls.on(a,this.onEvent)},this)}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)},this)}},{key:"onEvent",value:function(a,b){this.onEventGeneric(a,b)}},{key:"onEventGeneric",value:function(a,b){var c=function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b)};try{c.call(this,a,b).call()}catch(d){f.logger.error("internal error happened while processing "+a+":"+d.message),this.hls.trigger(i.default.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:d})}}}]),a}(),c.default=l},{33:33,35:35,54:54}],35:[function(a,b){"use strict";b.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],36:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,f;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){e(this,a)}return d(a,null,[{key:"getSilentFrame",value:function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),a}(),c.default=f},{}],37:[function(a,b){"use strict";var d={isBuffered:function(a,b){var c,d;if(a)for(c=a.buffered,d=0;d<c.length;d++)if(b>=c.start(d)&&b<=c.end(d))return!0;return!1},bufferInfo:function(a,b,c){if(a){var f,d=a.buffered,e=[];for(f=0;f<d.length;f++)e.push({start:d.start(f),end:d.end(f)});return this.bufferedInfo(e,b,c)}return{len:0,start:b,end:b,nextStart:void 0}},bufferedInfo:function(a,b,c){var e,f,g,h,i,j,k,l,m,d=[];for(a.sort(function(a,b){var c=a.start-b.start;return c?c:b.end-a.end}),i=0;i<a.length;i++)j=d.length,j?(k=d[j-1].end,a[i].start-k<c?a[i].end>k&&(d[j-1].end=a[i].end):d.push(a[i])):d.push(a[i]);for(i=0,e=0,f=g=b;i<d.length;i++)if(l=d[i].start,m=d[i].end,b+c>=l&&m>b)f=l,g=m,e=g-b;else if(l>b+c){h=l;break}return{len:e,start:f,end:g,nextStart:h}}};b.exports=d},{}],38:[function(a,b){"use strict";var d=a(54),e={mergeDetails:function(a,b){var k,l,m,n,o,c=Math.max(a.startSN,b.startSN)-b.startSN,f=Math.min(a.endSN,b.endSN)-b.startSN,g=b.startSN-a.startSN,h=a.fragments,i=b.fragments,j=0;if(c>f)return b.PTSKnown=!1,void 0;for(l=c;f>=l;l++)m=h[g+l],n=i[l],n&&m&&(j=m.cc-n.cc,isNaN(m.startPTS)||(n.start=n.startPTS=m.startPTS,n.endPTS=m.endPTS,n.duration=m.duration,n.backtracked=m.backtracked,n.dropped=m.dropped,k=n));if(j)for(d.logger.log("discontinuity sliding from playlist, take drift into account"),l=0;l<i.length;l++)i[l].cc+=j;if(k)e.updateFragPTSDTS(b,k,k.startPTS,k.endPTS,k.startDTS,k.endDTS);else if(g>=0&&g<h.length)for(o=h[g].start,l=0;l<i.length;l++)i[l].start+=o;b.PTSKnown=a.PTSKnown},updateFragPTSDTS:function(a,b,c,d,f,g){var i,j,k,l,m,n,h=c;if(isNaN(b.startPTS)||(i=Math.abs(b.startPTS-c),b.deltaPTS=isNaN(b.deltaPTS)?i:Math.max(i,b.deltaPTS),h=Math.max(c,b.startPTS),c=Math.min(c,b.startPTS),d=Math.max(d,b.endPTS),f=Math.min(f,b.startDTS),g=Math.max(g,b.endDTS)),j=c-b.start,b.start=b.startPTS=c,b.maxStartPTS=h,b.endPTS=d,b.startDTS=f,b.endDTS=g,b.duration=d-c,k=b.sn,!a||k<a.startSN||k>a.endSN)return 0;for(l=k-a.startSN,m=a.fragments,m[l]=b,n=l;n>0;n--)e.updatePTS(m,n,n-1);for(n=l;n<m.length-1;n++)e.updatePTS(m,n,n+1);return a.PTSKnown=!0,j},updatePTS:function(a,b,c){var e=a[b],f=a[c],g=f.startPTS;isNaN(g)?f.start=c>b?e.start+e.duration:Math.max(e.start-f.duration,0):c>b?(e.duration=g-e.start,e.duration<0&&d.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!")):(f.duration=e.start-g,f.duration<0&&d.logger.warn("negative duration computed for frag "+f.sn+",level "+f.level+", there should be some duration drift between playlist and fragment!"))}};b.exports=e},{54:54}],39:[function(a,b,c){"use strict";function z(a){return a&&a.__esModule?a:{"default":a}}function A(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,B;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(2),f=z(e),g=a(35),h=z(g),i=a(33),j=a(43),k=z(j),l=a(41),m=z(l),n=a(42),o=z(n),p=a(13),q=z(p),r=a(12),s=z(r),t=a(11),u=z(t),v=a(54),w=a(1),x=z(w),y=a(4),B=function(){function a(){var d,e,f,g,h,i,j,l,n,p,r,t,w,y,z,B,C,D,b=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(A(this,a),d=a.DefaultConfig,(c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(e in d)e in c||(c[e]=d[e]);if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||void 0===c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');v.enableLogs(c.debug),this.config=c,this._autoLevelCapping=-1,f=this.observer=new x.default,f.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];f.emit.apply(f,[a,a].concat(c))},f.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];f.removeListener.apply(f,[a].concat(c))},this.on=f.on.bind(f),this.off=f.off.bind(f),this.trigger=f.trigger.bind(f),g=this.abrController=new c.abrController(this),h=new c.bufferController(this),i=new c.capLevelController(this),j=new c.fpsController(this),l=new k.default(this),n=new m.default(this),p=new o.default(this),r=new u.default(this),t=this.levelController=new s.default(this),w=this.streamController=new q.default(this),y=[t,w],z=c.audioStreamController,z&&y.push(new z(this)),this.networkControllers=y,B=[l,n,p,g,h,i,j,r],z=c.audioTrackController,z&&(C=new z(this),this.audioTrackController=C,B.push(C)),z=c.subtitleTrackController,z&&(D=new z(this),this.subtitleTrackController=D,B.push(D)),[c.subtitleStreamController,c.timelineController].forEach(function(a){a&&B.push(new a(b))}),this.coreComponents=B}return d(a,null,[{key:"isSupported",value:function(){var a=window.MediaSource=window.MediaSource||window.WebKitMediaSource,b=window.SourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer,c=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),d=!b||b.prototype&&"function"==typeof b.prototype.appendBuffer&&"function"==typeof b.prototype.remove;return c&&d}},{key:"version",get:function(){return"0.7.11"}},{key:"Events",get:function(){return h.default}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:y.hlsDefaultConfig},set:function(b){a.defaultConfig=b}}]),d(a,[{key:"destroy",value:function(){v.logger.log("destroy"),this.trigger(h.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(a){v.logger.log("attachMedia"),this.media=a,this.trigger(h.default.MEDIA_ATTACHING,{media:a})}},{key:"detachMedia",value:function(){v.logger.log("detachMedia"),this.trigger(h.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(a){a=f.default.buildAbsoluteURL(window.location.href,a,{alwaysNormalize:!0}),v.logger.log("loadSource:"+a),this.url=a,this.trigger(h.default.MANIFEST_LOADING,{url:a})}},{key:"startLoad",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;v.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})}},{key:"stopLoad",value:function(){v.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})}},{key:"swapAudioCodec",value:function(){v.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){v.logger.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){v.logger.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){v.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){v.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){v.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){v.logger.log("set startLevel:"+a);var b=this;-1!==a&&(a=Math.max(a,b.minAutoLevel)),b.levelController.startLevel=a}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping
},set:function(a){v.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e,f,a=this,b=a.levels,c=a.config.minAutoBitrate,d=b?b.length:0;for(e=0;d>e;e++)if(f=b[e].realBitrate?Math.max(b[e].realBitrate,b[e].bitrate):b[e].bitrate,f>c)return e;return 0}},{key:"maxAutoLevel",get:function(){var a=this,b=a.levels,c=a.autoLevelCapping,d=void 0;return d=-1===c&&b&&b.length?b.length-1:c}},{key:"nextAutoLevel",get:function(){var a=this;return Math.min(Math.max(a.abrController.nextAutoLevel,a.minAutoLevel),a.maxAutoLevel)},set:function(a){var b=this;b.abrController.nextAutoLevel=Math.max(b.minAutoLevel,a)}},{key:"audioTracks",get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]}},{key:"audioTrack",get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)}}]),a}(),c.default=B},{1:1,11:11,12:12,13:13,2:2,33:33,35:35,4:4,41:41,42:42,43:43,54:54}],40:[function(a,b){"use strict";b.exports=a(39).default},{39:39}],41:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{"default":a}}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,j,o;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=k(e),g=a(34),h=k(g),i=a(33),j=a(54),o=function(a){function b(a){l(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.FRAG_LOADING));return c.loaders={},c}return n(b,a),d(b,[{key:"destroy",value:function(){var b,c,a=this.loaders;for(b in a)c=a[b],c&&c.destroy();this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var f,g,h,i,k,b=a.frag,c=b.type,d=this.loaders[c],e=this.hls.config;b.loaded=0,d&&(j.logger.warn("abort previous fragment loader for type:"+c),d.abort()),d=this.loaders[c]=b.loader="undefined"!=typeof e.fLoader?new e.fLoader(e):new e.loader(e),f=void 0,g=void 0,h=void 0,f={url:b.url,frag:b,responseType:"arraybuffer",progressData:!1},i=b.byteRangeStartOffset,k=b.byteRangeEndOffset,isNaN(i)||isNaN(k)||(f.rangeStart=i,f.rangeEnd=k),g={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(f,g,h)}},{key:"loadsuccess",value:function(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=a.data,g=c.frag;g.loader=void 0,this.loaders[g.type]=void 0,this.hls.trigger(f.default.FRAG_LOADED,{payload:e,frag:g,stats:b,networkDetails:d})}},{key:"loaderror",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=b.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(f.default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a,networkDetails:c})}},{key:"loadtimeout",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=b.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(f.default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag,networkDetails:c})}},{key:"loadprogress",value:function(a,b){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=b.frag;e.loaded=a.loaded,this.hls.trigger(f.default.FRAG_LOAD_PROGRESS,{frag:e,stats:a,networkDetails:d})}}]),b}(h.default),c.default=o},{33:33,34:34,35:35,54:54}],42:[function(a,b,c){"use strict";function k(a){return a&&a.__esModule?a:{"default":a}}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function n(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var d,e,f,g,h,i,j,o;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=k(e),g=a(34),h=k(g),i=a(33),j=a(54),o=function(a){function b(a){l(this,b);var c=m(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,f.default.KEY_LOADING));return c.loaders={},c.decryptkey=null,c.decrypturl=null,c}return n(b,a),d(b,[{key:"destroy",value:function(){var a,b;for(a in this.loaders)b=this.loaders[a],b&&b.destroy();this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(a){var h,i,k,l,b=a.frag,c=b.type,d=this.loaders[c],e=b.decryptdata,g=e.uri;g!==this.decrypturl||null===this.decryptkey?(h=this.hls.config,d&&(j.logger.warn("abort previous key loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new h.loader(h),this.decrypturl=g,this.decryptkey=null,i=void 0,k=void 0,l=void 0,i={url:g,frag:b,responseType:"arraybuffer"},k={timeout:h.fragLoadingTimeOut,maxRetry:h.fragLoadingMaxRetry,retryDelay:h.fragLoadingRetryDelay,maxRetryDelay:h.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(i,k,l)):this.decryptkey&&(e.key=this.decryptkey,this.hls.trigger(f.default.KEY_LOADED,{frag:b}))}},{key:"loadsuccess",value:function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[d.type]=void 0,this.hls.trigger(f.default.KEY_LOADED,{frag:d})}},{key:"loaderror",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(f.default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})}},{key:"loadtimeout",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(f.default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})}}]),b}(h.default),c.default=o},{33:33,34:34,35:35,54:54}],43:[function(a,b,c){"use strict";function o(a){return a&&a.__esModule?a:{"default":a}}function p(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function q(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function r(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,m,n,s,t,u,v,w,x,y;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(2),f=o(e),g=a(35),h=o(g),i=a(34),j=o(i),k=a(33),l=a(47),m=o(l),n=a(54),s=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,t=/#EXT-X-MEDIA:(.*)/g,u=new RegExp([/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),v=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,w=function(){function a(){r(this,a),this.method=null,this.key=null,this.iv=null,this._uri=null}return d(a,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=f.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),a}(),x=function(){function a(){r(this,a),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return d(a,[{key:"createInitializationVector",value:function(a){var c,b=new Uint8Array(16);for(c=12;16>c;c++)b[c]=255&a>>8*(15-c);return b}},{key:"fragmentDecryptdataFromLevelkey",value:function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&(c=new w,c.method=a.method,c.baseuri=a.baseuri,c.reluri=a.reluri,c.iv=this.createInitializationVector(b)),c}},{key:"cloneObj",value:function(a){return JSON.parse(JSON.stringify(a))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=f.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(a){this._url=a}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){var a,b,c;return this._byteRange||(a=this._byteRange=[],this.rawByteRange&&(b=this.rawByteRange.split("@",2),1===b.length?(c=this.lastByteRangeEndOffset,a[0]=c?c:0):a[0]=parseInt(b[1]),a[1]=parseInt(b[0])+a[0])),this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),a}(),y=function(a){function b(a){r(this,b);var c=p(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,h.default.MANIFEST_LOADING,h.default.LEVEL_LOADING,h.default.AUDIO_TRACK_LOADING,h.default.SUBTITLE_TRACK_LOADING));return c.loaders={},c}return q(b,a),d(b,[{key:"destroy",value:function(){var a,b;for(a in this.loaders)b=this.loaders[a],b&&b.destroy();this.loaders={},j.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(a){this.load(a.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(a){this.load(a.url,{type:"level",level:a.level,id:a.id})}},{key:"onAudioTrackLoading",value:function(a){this.load(a.url,{type:"audioTrack",id:a.id})}},{key:"onSubtitleTrackLoading",value:function(a){this.load(a.url,{type:"subtitleTrack",id:a.id})}},{key:"load",value:function(a,b){var d,e,f,g,h,i,j,k,c=this.loaders[b.type];if(c){if(d=c.context,d&&d.url===a)return n.logger.trace("playlist request ongoing"),void 0;n.logger.warn("abort previous loader for type:"+b.type),c.abort()}e=this.hls.config,f=void 0,g=void 0,h=void 0,i=void 0,"manifest"===b.type?(f=e.manifestLoadingMaxRetry,g=e.manifestLoadingTimeOut,h=e.manifestLoadingRetryDelay,i=e.manifestLoadingMaxRetryTimeout):(f=e.levelLoadingMaxRetry,g=e.levelLoadingTimeOut,h=e.levelLoadingRetryDelay,i=e.levelLoadingMaxRetryTimeout,n.logger.log("loading playlist for "+b.type+" "+(b.level||b.id))),c=this.loaders[b.type]=b.loader="undefined"!=typeof e.pLoader?new e.pLoader(e):new e.loader(e),b.url=a,b.responseType="",j=void 0,k=void 0,j={timeout:g,maxRetry:f,retryDelay:h,maxRetryDelay:i},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},c.load(b,j,k)}},{key:"resolve",value:function(a,b){return f.default.buildAbsoluteURL(b,a,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(a,b){var e,f,g,h,i,j,c=[],d=void 0;for(s.lastIndex=0;null!=(d=s.exec(a));){if(e={},f=e.attrs=new m.default(d[1]),e.url=this.resolve(d[2],b),g=f.decimalResolution("RESOLUTION"),g&&(e.width=g.width,e.height=g.height),e.bitrate=f.decimalInteger("AVERAGE-BANDWIDTH")||f.decimalInteger("BANDWIDTH"),e.name=f.NAME,h=f.CODECS)for(h=h.split(/[ ,]+/),i=0;i<h.length;i++)j=h[i],-1!==j.indexOf("avc1")?e.videoCodec=this.avc1toavcoti(j):-1!==j.indexOf("hvc1")?e.videoCodec=j:e.audioCodec=j;c.push(e)}return c}},{key:"parseMasterPlaylistMedia",value:function(a,b,c){var h,i,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=void 0,f=[],g=0;for(t.lastIndex=0;null!=(e=t.exec(a));)h={},i=new m.default(e[1]),i.TYPE===c&&(h.groupId=i["GROUP-ID"],h.name=i.NAME,h.type=c,h.default="YES"===i.DEFAULT,h.autoselect="YES"===i.AUTOSELECT,h.forced="YES"===i.FORCED,i.URI&&(h.url=this.resolve(i.URI,b)),h.lang=i.LANGUAGE,h.name||(h.name=h.lang),d&&(h.audioCodec=d),h.id=g++,f.push(h));return f}},{key:"avc1toavcoti",value:function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b}},{key:"parseLevelPlaylist",value:function(a,b,c,d){var l,o,p,q,r,s,t,y,z,A,B,C,D,E,F,G,H,e=0,f=0,g={type:null,version:null,url:b,fragments:[],live:!0,startSN:0},h=new w,i=0,j=null,k=new x;for(u.lastIndex=0;null!==(l=u.exec(a));)if(p=l[1])k.duration=parseFloat(p),q=(" "+l[2]).slice(1),k.title=q?q:null,k.tagList.push(q?["INF",p,q]:["INF",p]);else if(l[3])isNaN(k.duration)||(r=e++,k.type=d,k.start=f,k.levelkey=h,k.sn=r,k.level=c,k.cc=i,k.baseurl=b,k.relurl=(" "+l[3]).slice(1),g.fragments.push(k),j=k,f+=k.duration,k=new x);else if(l[4])k.rawByteRange=(" "+l[4]).slice(1),j&&(s=j.byteRangeEndOffset,s&&(k.lastByteRangeEndOffset=s));else if(l[5])k.rawProgramDateTime=(" "+l[5]).slice(1),k.tagList.push(["PROGRAM-DATE-TIME",k.rawProgramDateTime]);else{for(l=l[0].match(v),o=1;o<l.length&&void 0===l[o];o++);switch(t=(" "+l[o+1]).slice(1),y=(" "+l[o+2]).slice(1),l[o]){case"#":k.tagList.push(y?[t,y]:[t]);break;case"PLAYLIST-TYPE":g.type=t.toUpperCase();break;case"MEDIA-SEQUENCE":e=g.startSN=parseInt(t);break;case"TARGETDURATION":g.targetduration=parseFloat(t);break;case"VERSION":g.version=parseInt(t);break;case"EXTM3U":break;case"ENDLIST":g.live=!1;break;case"DIS":i++,k.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":i=parseInt(t);break;case"KEY":z=t,A=new m.default(z),B=A.enumeratedString("METHOD"),C=A.URI,D=A.hexadecimalInteger("IV"),B&&(h=new w,C&&["AES-128","SAMPLE-AES"].indexOf(B)>=0&&(h.method=B,h.baseuri=b,h.reluri=C,h.key=null,h.iv=D));break;case"START":E=t,F=new m.default(E),G=F.decimalFloatingPoint("TIME-OFFSET"),isNaN(G)||(g.startTimeOffset=G);break;case"MAP":H=new m.default(t),k.relurl=H.URI,k.rawByteRange=H.BYTERANGE,k.baseurl=b,k.level=c,k.type=d,k.sn="initSegment",g.initSegment=k,k=new x;break;default:n.logger.warn("line parsed but not handled: "+l)}}return k=j,k&&!k.relurl&&(g.fragments.pop(),f-=k.duration),g.totalduration=f,g.averagetargetduration=f/g.fragments.length,g.endSN=e-1,g}},{key:"loadsuccess",value:function(a,b,c){var m,o,p,q,r,s,t,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=a.data,f=a.url,g=c.type,i=c.id,j=c.level,l=this.hls;this.loaders[g]=void 0,(void 0===f||0===f.indexOf("data:"))&&(f=c.url),b.tload=performance.now(),0===e.indexOf("#EXTM3U")?e.indexOf("#EXTINF:")>0?(m="audioTrack"!==g&&"subtitleTrack"!==g,o=isNaN(j)?isNaN(i)?0:i:j,p=this.parseLevelPlaylist(e,f,o,"audioTrack"===g?"audio":"subtitleTrack"===g?"subtitle":"main"),p.tload=b.tload,"manifest"===g&&l.trigger(h.default.MANIFEST_LOADED,{levels:[{url:f,details:p}],audioTracks:[],url:f,stats:b,networkDetails:d}),b.tparsed=performance.now(),p.targetduration?m?l.trigger(h.default.LEVEL_LOADED,{details:p,level:j||0,id:i||0,stats:b,networkDetails:d}):"audioTrack"===g?l.trigger(h.default.AUDIO_TRACK_LOADED,{details:p,id:i,stats:b,networkDetails:d}):"subtitleTrack"===g&&l.trigger(h.default.SUBTITLE_TRACK_LOADED,{details:p,id:i,stats:b,networkDetails:d}):l.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"invalid targetduration",networkDetails:d})):(q=this.parseMasterPlaylist(e,f),q.length?(r=this.parseMasterPlaylistMedia(e,f,"AUDIO",q[0].audioCodec),s=this.parseMasterPlaylistMedia(e,f,"SUBTITLES"),r.length&&(t=!1,r.forEach(function(a){a.url||(t=!0)}),t===!1&&q[0].audioCodec&&!q[0].attrs.AUDIO&&(n.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),r.unshift({type:"main",name:"main"}))),l.trigger(h.default.MANIFEST_LOADED,{levels:q,audioTracks:r,subtitles:s,url:f,stats:b,networkDetails:d})):l.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"no level found in manifest",networkDetails:d})):l.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:f,reason:"no EXTM3U delimiter",networkDetails:d})}},{key:"loaderror",value:function(a,b){var d,e,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=b.loader;switch(b.type){case"manifest":d=k.ErrorDetails.MANIFEST_LOAD_ERROR,e=!0;break;case"level":d=k.ErrorDetails.LEVEL_LOAD_ERROR,e=!1;break;case"audioTrack":d=k.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,e=!1}f&&(f.abort(),this.loaders[b.type]=void 0),this.hls.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:d,fatal:e,url:f.url,loader:f,response:a,context:b,networkDetails:c})}},{key:"loadtimeout",value:function(a,b){var d,e,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=b.loader;switch(b.type){case"manifest":d=k.ErrorDetails.MANIFEST_LOAD_TIMEOUT,e=!0;break;case"level":d=k.ErrorDetails.LEVEL_LOAD_TIMEOUT,e=!1;break;case"audioTrack":d=k.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,e=!1}f&&(f.abort(),this.loaders[b.type]=void 0),this.hls.trigger(h.default.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:d,fatal:e,url:f.url,loader:f,context:b,networkDetails:c})}}]),b}(j.default),c.default=y},{2:2,33:33,34:34,35:35,47:47,54:54}],44:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,f,g;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=Math.pow(2,32)-1,g=function(){function a(){e(this,a)}return d(a,null,[{key:"init",value:function(){var b,c,d,e,f,g,h,i;a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),a.HDLR_TYPES={video:c,audio:d},e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]),a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]),a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))}},{key:"box",value:function(a){for(var f,b=Array.prototype.slice.call(arguments,1),c=8,d=b.length,e=d;d--;)c+=b[d].byteLength;for(f=new Uint8Array(c),f[0]=255&c>>24,f[1]=255&c>>16,f[2]=255&c>>8,f[3]=255&c,f.set(a,4),d=0,c=8;e>d;d++)f.set(b[d],c),c+=b[d].byteLength;return f}},{key:"hdlr",value:function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])}},{key:"mdat",value:function(b){return a.box(a.types.mdat,b)}},{key:"mdhd",value:function(b,c){var d,e;return c*=b,d=Math.floor(c/(f+1)),e=Math.floor(c%(f+1)),a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&b>>24,255&b>>16,255&b>>8,255&b,d>>24,255&d>>16,255&d>>8,255&d,e>>24,255&e>>16,255&e>>8,255&e,85,196,0,0]))}},{key:"mdia",value:function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))}},{key:"mfhd",value:function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,255&b>>16,255&b>>8,255&b]))}},{key:"minf",value:function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))}},{key:"moof",value:function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))}},{key:"moov",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))}},{key:"mvex",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))}},{key:"mvhd",value:function(b,c){var d,e,g;return c*=b,d=Math.floor(c/(f+1)),e=Math.floor(c%(f+1)),g=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&b>>24,255&b>>16,255&b>>8,255&b,d>>24,255&d>>16,255&d>>8,255&d,e>>24,255&e>>16,255&e>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]),a.box(a.types.mvhd,g)}},{key:"sdtp",value:function(b){var e,f,c=b.samples||[],d=new Uint8Array(4+c.length);for(f=0;f<c.length;f++)e=c[f].flags,d[f+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return a.box(a.types.sdtp,d)}},{key:"stbl",value:function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))}},{key:"avc1",value:function(b){var e,f,g,h,i,j,k,l,c=[],d=[];for(e=0;e<b.sps.length;e++)f=b.sps[e],g=f.byteLength,c.push(255&g>>>8),c.push(255&g),c=c.concat(Array.prototype.slice.call(f));for(e=0;e<b.pps.length;e++)f=b.pps[e],g=f.byteLength,d.push(255&g>>>8),d.push(255&g),d=d.concat(Array.prototype.slice.call(f));return h=a.box(a.types.avcC,new Uint8Array([1,c[3],c[4],c[5],255,224|b.sps.length].concat(c).concat([b.pps.length]).concat(d))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1],a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255&i>>8,255&i,255&j>>8,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,255&k>>16,255&k>>8,255&k,l>>24,255&l>>16,255&l>>8,255&l])))}},{key:"esds",value:function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))}},{key:"mp4a",value:function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,255&c>>8,255&c,0,0]),a.box(a.types.esds,a.esds(b)))}},{key:"mp3",value:function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,255&c>>8,255&c,0,0]))}},{key:"stsd",value:function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))}},{key:"tkhd",value:function(b){var c=b.id,d=b.duration*b.timescale,e=b.width,g=b.height,h=Math.floor(d/(f+1)),i=Math.floor(d%(f+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&c>>24,255&c>>16,255&c>>8,255&c,0,0,0,0,h>>24,255&h>>16,255&h>>8,255&h,i>>24,255&i>>16,255&i>>8,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,255&e>>8,255&e,0,0,255&g>>8,255&g,0,0]))}},{key:"traf",value:function(b,c){var d=a.sdtp(b),e=b.id,g=Math.floor(c/(f+1)),h=Math.floor(c%(f+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,255&e>>16,255&e>>8,255&e])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,g>>24,255&g>>16,255&g>>8,255&g,h>>24,255&h>>16,255&h>>8,255&h])),a.trun(b,d.length+16+20+8+16+8+8),d)}},{key:"trak",value:function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))}},{key:"trex",value:function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,255&c>>16,255&c>>8,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(b,c){var h,i,j,k,l,m,d=b.samples||[],e=d.length,f=12+16*e,g=new Uint8Array(f);for(c+=8+f,g.set([0,0,15,1,255&e>>>24,255&e>>>16,255&e>>>8,255&e,255&c>>>24,255&c>>>16,255&c>>>8,255&c],0),h=0;e>h;h++)i=d[h],j=i.duration,k=i.size,l=i.flags,m=i.cts,g.set([255&j>>>24,255&j>>>16,255&j>>>8,255&j,255&k>>>24,255&k>>>16,255&k>>>8,255&k,l.isLeading<<2|l.dependsOn,l.isDependedOn<<6|l.hasRedundancy<<4|l.paddingValue<<1|l.isNonSync,61440&l.degradPrio,15&l.degradPrio,255&m>>>24,255&m>>>16,255&m>>>8,255&m],12+16*h);return a.box(a.types.trun,g)}},{key:"initSegment",value:function(b){a.types||a.init();var d,c=a.moov(b);return d=new Uint8Array(a.FTYP.byteLength+c.byteLength),d.set(a.FTYP),d.set(c,a.FTYP.byteLength),d}}]),a}(),c.default=g},{}],45:[function(a,b,c){"use strict";function m(a){return a&&a.__esModule?a:{"default":a}}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k,l,o,p;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(36),f=m(e),g=a(35),h=m(g),i=a(54),j=a(44),k=m(j),l=a(33),o=1e4,p=function(){function a(b,c,d,e){n(this,a),this.observer=b,this.config=c,this.typeSupported=d;var f=navigator.userAgent;this.isSafari=e&&e.indexOf("Apple")>-1&&f&&!f.match("CriOS"),this.ISGenerated=!1}return d(a,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(a){this._initPTS=this._initDTS=a}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(a,b,c,d,e,f,g){var j,k,l,m,n,o,p,q,r,s,t;this.ISGenerated?g&&(j=this._initPTS,k=this._PTSNormalize,l=a.inputTimeScale||b.inputTimeScale,m=1/0,n=1/0,o=a.samples,o.length&&(m=n=k(o[0].pts-l*e,j)),o=b.samples,o.length&&(p=o[0],m=Math.min(m,k(p.pts-l*e,j)),n=Math.min(n,k(p.dts-l*e,j))),1/0!==m&&(q=j-m,Math.abs(q)>10*l&&(i.logger.warn("timestamp inconsistency, "+(q/l).toFixed(3)+"s delta against expected value: missing discontinuity ? reset initPTS/initDTS"),this._initPTS=m,this._initDTS=n,this.observer.trigger(h.default.INIT_PTS_FOUND,{initPTS:m})))):this.generateIS(a,b,e),this.ISGenerated&&(a.samples.length?(a.timescale||(i.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(a,b,e)),r=this.remuxAudio(a,e,f,g),b.samples.length&&(s=void 0,r&&(s=r.endPTS-r.startPTS),b.timescale||(i.logger.warn("regenerate InitSegment as video detected"),this.generateIS(a,b,e)),this.remuxVideo(b,e,f,s,g))):(t=void 0,b.samples.length&&(t=this.remuxVideo(b,e,f,g)),t&&a.codec&&this.remuxEmptyAudio(a,e,f,t))),c.samples.length&&this.remuxID3(c,e),d.samples.length&&this.remuxText(d,e),this.observer.trigger(h.default.FRAG_PARSED)}},{key:"generateIS",value:function(a,b,c){var p,q,r,d=this.observer,e=a.samples,f=b.samples,g=this.typeSupported,j="audio/mp4",m={},n={tracks:m},o=void 0===this._initPTS;o&&(p=q=1/0),a.config&&e.length&&(a.timescale=a.samplerate,i.logger.log("audio sampling rate : "+a.samplerate),a.isAAC||(g.mpeg?(j="audio/mpeg",a.codec=""):g.mp3&&(a.codec="mp3")),m.audio={container:j,codec:a.codec,initSegment:!a.isAAC&&g.mpeg?new Uint8Array:k.default.initSegment([a]),metadata:{channelCount:a.channelCount}},o&&(p=q=e[0].pts-a.inputTimeScale*c)),b.sps&&b.pps&&f.length&&(r=b.inputTimeScale,b.timescale=r,m.video={container:"video/mp4",codec:b.codec,initSegment:k.default.initSegment([b]),metadata:{width:b.width,height:b.height}},o&&(p=Math.min(p,f[0].pts-r*c),q=Math.min(q,f[0].dts-r*c),this.observer.trigger(h.default.INIT_PTS_FOUND,{initPTS:p}))),Object.keys(m).length?(d.trigger(h.default.FRAG_PARSING_INIT_SEGMENT,n),this.ISGenerated=!0,o&&(this._initPTS=p,this._initDTS=q)):d.trigger(h.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(a,b,c,d,e){var j,m,n,o,p,q,r,s,A,B,C,D,E,F,G,H,I,J,K,L,M,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,f=8,g=a.timescale,t=a.samples,u=[],v=t.length,w=this._PTSNormalize,x=this._initDTS,y=this.nextAvcDts,z=this.isSafari;if(z&&(c|=t.length&&y&&(e&&Math.abs(b-y/g)<.1||Math.abs(t[0].pts-y-x)<g/5)),c||(y=b*g),t.forEach(function(a){a.pts=w(a.pts-x,y),a.dts=w(a.dts-x,y)}),t.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c?c:d?d:a.id-b.id}),A=t.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0),0>A)for(i.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(A/90)+" ms to overcome this issue"),B=0;B<t.length;B++)t[B].dts+=A;for(C=t[0],p=Math.max(C.dts,0),o=Math.max(C.pts,0),D=Math.round((p-y)/90),c&&D&&(D>1?i.logger.log("AVC:"+D+" ms hole between fragments detected,filling it"):-1>D&&i.logger.log("AVC:"+-D+" ms overlapping between fragments detected"),p=y,t[0].dts=p,o=Math.max(o-D,y),t[0].pts=o,i.logger.log("Video/PTS/DTS adjusted: "+Math.round(o/90)+"/"+Math.round(p/90)+",delta:"+D+" ms")),q=p,C=t[t.length-1],s=Math.max(C.dts,0),r=Math.max(C.pts,0,s),z&&(j=Math.round((s-p)/(t.length-1))),E=0,F=0,G=0;v>G;G++){for(H=t[G],I=H.units,J=I.length,K=0,L=0;J>L;L++)K+=I[L].data.length;F+=K,E+=J,H.length=K,H.dts=z?p+G*j:Math.max(H.dts,p),H.pts=Math.max(H.pts,H.dts)}M=F+4*E+8;try{m=new Uint8Array(M)}catch(N){return this.observer.trigger(h.default.ERROR,{type:l.ErrorTypes.MUX_ERROR,details:l.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:M,reason:"fail allocating video mdat "+M}),void 0}for(O=new DataView(m.buffer),O.setUint32(0,M),m.set(k.default.types.mdat,4),P=0;v>P;P++){for(Q=t[P],R=Q.units,S=0,T=void 0,U=0,V=R.length;V>U;U++)W=R[U],X=W.data,Y=W.data.byteLength,O.setUint32(f,Y),f+=4,m.set(X,f),f+=Y,S+=4+Y;z?T=Math.max(0,j*Math.round((Q.pts-Q.dts)/j)):(v-1>P?j=t[P+1].dts-Q.dts:(Z=this.config,$=Q.dts-t[P>0?P-1:P].dts,Z.stretchShortVideoTrack?(_=Z.maxBufferHole,ab=Z.maxSeekHole,bb=Math.floor(Math.min(_,ab)*g),cb=(d?o+d*g:this.nextAudioPts)-Q.pts,cb>bb?(j=cb-$,0>j&&(j=$),i.logger.log("It is approximately "+cb/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=$):j=$),T=Math.round(Q.pts-Q.dts)),u.push({size:S,duration:j,cts:T,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:Q.key?2:1,isNonSync:Q.key?0:1}})
}return this.nextAvcDts=s+j,db=a.dropped,a.len=0,a.nbNalu=0,a.dropped=0,u.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(eb=u[0].flags,eb.dependsOn=2,eb.isNonSync=0),a.samples=u,n=k.default.moof(a.sequenceNumber++,p,a),a.samples=[],fb={data1:n,data2:m,startPTS:o/g,endPTS:(r+j)/g,startDTS:p/g,endDTS:this.nextAvcDts/g,type:"video",nb:u.length,dropped:db},this.observer.trigger(h.default.FRAG_PARSING_DATA,fb),fb}},{key:"remuxAudio",value:function(a,b,c,d){var s,t,u,v,w,x,y,C,D,F,E,G,H,I,J,K,L,M,N,O,P,Q,R,S,U,V,W,X,Y,Z,$,_,e=a.inputTimeScale,g=a.timescale,j=e/g,m=a.isAAC?1024:1152,n=m*j,p=this._PTSNormalize,q=this._initDTS,r=!a.isAAC&&this.typeSupported.mpeg,z=a.samples,A=[],B=this.nextAudioPts;if(c|=z.length&&B&&(d&&Math.abs(b-B/e)<.1||Math.abs(z[0].pts-B-q)<20*n),c||(B=b*e),z.forEach(function(a){a.pts=a.dts=p(a.pts-q,B)}),z.sort(function(a,b){return a.pts-b.pts}),d&&a.isAAC)for(C=0,D=B;C<z.length;)if(E=z[C],G=E.pts,F=G-D,H=Math.abs(1e3*F/e),-n>=F)i.logger.warn("Dropping 1 audio frame @ "+(D/e).toFixed(3)+"s due to "+H+" ms overlap."),z.splice(C,1),a.len-=E.unit.length;else if(F>=n&&o>H&&D){for(I=Math.round(F/n),i.logger.warn("Injecting "+I+" audio frame @ "+(D/e).toFixed(3)+"s due to "+Math.round(1e3*F/e)+" ms gap."),J=0;I>J;J++)K=Math.max(D,0),u=f.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),u||(i.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),u=E.unit.subarray()),z.splice(C,0,{unit:u,pts:K,dts:K}),a.len+=u.length,D+=n,C++;E.pts=E.dts=D,D+=n,C++}else Math.abs(F)>.1*n,E.pts=E.dts=D,D+=n,C++;for(L=0,M=z.length;M>L;L++){if(N=z[L],O=N.unit,P=N.pts,void 0!==y)t.duration=Math.round((P-y)/j);else{if(Q=Math.round(1e3*(P-B)/e),R=0,c&&a.isAAC&&Q){if(Q>0&&o>Q)R=Math.round((P-B)/n),i.logger.log(Q+" ms hole between AAC samples detected,filling it"),R>0&&(u=f.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),u||(u=O.subarray()),a.len+=R*u.length);else if(-12>Q){i.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(B/e).toFixed(3)+"s/"+(P/e).toFixed(3)+"s/"+-Q+"ms"),a.len-=O.byteLength;continue}P=B}if(x=Math.max(0,P),!(a.len>0))return;S=r?a.len:a.len+8,s=r?0:8;try{v=new Uint8Array(S)}catch(T){return this.observer.trigger(h.default.ERROR,{type:l.ErrorTypes.MUX_ERROR,details:l.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:S,reason:"fail allocating audio mdat "+S}),void 0}for(r||(U=new DataView(v.buffer),U.setUint32(0,S),v.set(k.default.types.mdat,4)),V=0;R>V;V++)u=f.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),u||(i.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),u=O.subarray()),v.set(u,s),s+=u.byteLength,t={size:u.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(t)}v.set(O,s),W=O.byteLength,s+=W,t={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(t),y=P}return X=0,Y=A.length,Y>=2&&(X=A[Y-2].duration,t.duration=X),Y?(this.nextAudioPts=B=y+j*X,a.len=0,a.samples=A,w=r?new Uint8Array:k.default.moof(a.sequenceNumber++,x/j,a),a.samples=[],Z=x/e,$=B/e,_={data1:w,data2:v,startPTS:Z,endPTS:$,startDTS:Z,endDTS:$,type:"audio",nb:Y},this.observer.trigger(h.default.FRAG_PARSING_DATA,_),_):null}},{key:"remuxEmptyAudio",value:function(a,b,c,d){var q,r,s,e=a.inputTimeScale,g=a.samplerate?a.samplerate:e,h=e/g,j=this.nextAudioPts,k=(void 0!==j?j:d.startDTS*e)+this._initDTS,l=d.endDTS*e+this._initDTS,m=1024,n=h*m,o=Math.ceil((l-k)/n),p=f.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(i.logger.warn("remux empty Audio"),!p)return i.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!"),void 0;for(q=[],r=0;o>r;r++)s=k+r*n,q.push({unit:p,pts:s,dts:s}),a.len+=p.length;a.samples=q,this.remuxAudio(a,b,c)}},{key:"remuxID3",value:function(a,b){var d,i,c=a.samples.length,e=a.inputTimeScale,f=this._initPTS,g=this._initDTS;if(c){for(i=0;c>i;i++)d=a.samples[i],d.pts=(d.pts-f)/e,d.dts=(d.dts-g)/e;this.observer.trigger(h.default.FRAG_PARSING_METADATA,{samples:a.samples})}a.samples=[],b=b}},{key:"remuxText",value:function(a,b){var d,c,e,f,g;if(a.samples.sort(function(a,b){return a.pts-b.pts}),c=a.samples.length,e=a.inputTimeScale,f=this._initPTS,c){for(g=0;c>g;g++)d=a.samples[g],d.pts=(d.pts-f)/e;this.observer.trigger(h.default.FRAG_PARSING_USERDATA,{samples:a.samples})}a.samples=[],b=b}},{key:"_PTSNormalize",value:function(a,b){var c;if(void 0===b)return a;for(c=a>b?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a}}]),a}(),c.default=p},{33:33,35:35,36:36,44:44,54:54}],46:[function(a,b,c){"use strict";function g(a){return a&&a.__esModule?a:{"default":a}}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,i;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(35),f=g(e),i=function(){function a(b){h(this,a),this.observer=b}return d(a,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(a,b,c,d,e,g,h,i){var j=this.observer,k="";a&&(k+="audio"),b&&(k+="video"),j.trigger(f.default.FRAG_PARSING_DATA,{data1:i,startPTS:e,startDTS:e,type:k,nb:1,dropped:0}),j.trigger(f.default.FRAG_PARSED)}}]),a}(),c.default=i},{35:35}],47:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,f,g,h;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=/^(\d+)x(\d+)$/,g=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,h=function(){function a(b){e(this,a),"string"==typeof b&&(b=a.parseAttrList(b));for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}return d(a,[{key:"decimalInteger",value:function(a){var b=parseInt(this[a],10);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"hexadecimalInteger",value:function(a){var b,c,d;if(this[a]){for(b=(this[a]||"0x").slice(2),b=(1&b.length?"0":"")+b,c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null}},{key:"hexadecimalIntegerAsNumber",value:function(a){var b=parseInt(this[a],16);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"decimalFloatingPoint",value:function(a){return parseFloat(this[a])}},{key:"enumeratedString",value:function(a){return this[a]}},{key:"decimalResolution",value:function(a){var b=f.exec(this[a]);return null===b?void 0:{width:parseInt(b[1],10),height:parseInt(b[2],10)}}}],[{key:"parseAttrList",value:function(a){var b,d,e,c={};for(g.lastIndex=0;null!==(b=g.exec(a));)d=b[2],e='"',0===d.indexOf(e)&&d.lastIndexOf(e)===d.length-1&&(d=d.slice(1,-1)),c[b[1]]=d;return c}}]),a}(),c.default=h},{}],48:[function(a,b){"use strict";var d={search:function(a,b){for(var g,c=0,d=a.length-1,e=null,f=null;d>=c;)if(e=0|(c+d)/2,f=a[e],g=b(f),g>0)c=e+1;else{if(!(0>g))return f;d=e-1}return null}};b.exports=d},{}],49:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},g=function(a){var b=a;return f.hasOwnProperty(a)&&(b=f[a]),String.fromCharCode(b)},h=15,i=100,j={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},k={17:2,18:4,21:6,22:8,23:10,19:13,20:15},l={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},n=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],o={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){var c=this.verboseFilter[a];this.verboseLevel>=c&&console.log(this.time+" ["+a+"] "+b)}},p=function(a){var c,b=[];for(c=0;c<a.length;c++)b.push(a[c].toString(16));return b},q=function(){function a(b,c,d,f,g){e(this,a),this.foreground=b||"white",this.underline=c||!1,this.italics=d||!1,this.background=f||"black",this.flash=g||!1}return d(a,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(a){var c,d,b=["foreground","underline","italics","background","flash"];for(c=0;c<b.length;c++)d=b[c],a.hasOwnProperty(d)&&(this[d]=a[d])}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash}},{key:"copy",value:function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),a}(),r=function(){function a(b,c,d,f,g,h){e(this,a),this.uchar=b||" ",this.penState=new q(c,d,f,g,h)}return d(a,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(a,b){this.uchar=a,this.penState.copy(b)}},{key:"setPenState",value:function(a){this.penState.copy(a)}},{key:"equals",value:function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)}},{key:"copy",value:function(a){this.uchar=a.uchar,this.penState.copy(a.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),a}(),s=function(){function a(){e(this,a),this.chars=[];for(var b=0;i>b;b++)this.chars.push(new r);this.pos=0,this.currPenState=new q}return d(a,[{key:"equals",value:function(a){var c,b=!0;for(c=0;i>c;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;i>b;b++)this.chars[b].copy(a.chars[b])}},{key:"isEmpty",value:function(){var b,a=!0;for(b=0;i>b;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a}},{key:"setCursor",value:function(a){this.pos!==a&&(this.pos=a),this.pos<0?(o.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(o.log("ERROR","Too large cursor position "+this.pos),this.pos=i)}},{key:"moveCursor",value:function(a){var c,b=this.pos+a;if(a>1)for(c=this.pos+1;b+1>c;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(a){a>=144&&this.backSpace();var b=g(a);return this.pos>=i?(o.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"),void 0):(this.chars[this.pos].setChar(b,this.currPenState),this.moveCursor(1),void 0)}},{key:"clearFromPos",value:function(a){var b;for(b=a;i>b;b++)this.chars[b].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){var c,d,a=[],b=!0;for(c=0;i>c;c++)d=this.chars[c].uchar," "!==d&&(b=!1),a.push(d);return b?"":a.join("")}},{key:"setPenStyles",value:function(a){this.currPenState.setStyles(a);var b=this.chars[this.pos];b.setPenState(this.currPenState)}}]),a}(),t=function(){function a(){e(this,a),this.rows=[];for(var b=0;h>b;b++)this.rows.push(new s);this.currRow=h-1,this.nrRollUpRows=null,this.reset()}return d(a,[{key:"reset",value:function(){for(var a=0;h>a;a++)this.rows[a].clear();this.currRow=h-1}},{key:"equals",value:function(a){var c,b=!0;for(c=0;h>c;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;h>b;b++)this.rows[b].copy(a.rows[b])}},{key:"isEmpty",value:function(){var b,a=!0;for(b=0;h>b;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a}},{key:"backSpace",value:function(){var a=this.rows[this.currRow];a.backSpace()}},{key:"clearToEndOfRow",value:function(){var a=this.rows[this.currRow];a.clearToEndOfRow()}},{key:"insertChar",value:function(a){var b=this.rows[this.currRow];b.insertChar(a)}},{key:"setPen",value:function(a){var b=this.rows[this.currRow];b.setPenStyles(a)}},{key:"moveCursor",value:function(a){var b=this.rows[this.currRow];b.moveCursor(a)}},{key:"setCursor",value:function(a){o.log("INFO","setCursor: "+a);var b=this.rows[this.currRow];b.setCursor(a)}},{key:"setPAC",value:function(a){var b,c,d,e,f,g,i,j,k,l;if(o.log("INFO","pacData = "+JSON.stringify(a)),b=a.row-1,this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(c=0;h>c;c++)this.rows[c].clear();if(d=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen,e&&(f=e.rows[d].cueStartTime,f&&f<o.time))for(g=0;g<this.nrRollUpRows;g++)this.rows[b-this.nrRollUpRows+g+1].copy(e.rows[d+g])}this.currRow=b,i=this.rows[this.currRow],null!==a.indent&&(j=a.indent,k=Math.max(j-1,0),i.setCursor(a.indent),a.color=i.chars[k].penState.foreground),l={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1},this.setPen(l)}},{key:"setBkgData",value:function(a){o.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)}},{key:"setRollUpRows",value:function(a){this.nrRollUpRows=a}},{key:"rollUp",value:function(){var a,b;return null===this.nrRollUpRows?(o.log("DEBUG","roll_up but nrRollUpRows not set yet"),void 0):(o.log("TEXT",this.getDisplayText()),a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0],b.clear(),this.rows.splice(this.currRow,0,b),o.log("INFO","Rolling up"),void 0)}},{key:"getDisplayText",value:function(a){var b,c,d,e,f;for(a=a||!1,b=[],c="",d=-1,e=0;h>e;e++)f=this.rows[e].getTextString(),f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()));return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c}},{key:"getTextAndFormat",value:function(){return this.rows}}]),a}(),u=function(){function a(b,c){e(this,a),this.chNr=b,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new t,this.nonDisplayedMemory=new t,this.lastOutputScreen=new t,this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return d(a,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(a){this.outputFilter=a}},{key:"setPAC",value:function(a){this.writeScreen.setPAC(a)}},{key:"setBkgData",value:function(a){this.writeScreen.setBkgData(a)}},{key:"setMode",value:function(a){a!==this.mode&&(this.mode=a,o.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)}},{key:"insertChars",value:function(a){var b,c;for(b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP",o.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(o.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){o.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){o.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){o.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(a){o.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)}},{key:"ccFON",value:function(){o.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){o.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){o.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){o.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){o.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){o.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){o.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(o.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,o.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(a){o.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)}},{key:"ccMIDROW",value:function(a){var c,d,b={flash:!1};b.underline=1===a%2,b.italics=a>=46,b.italics?b.foreground="white":(c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"],b.foreground=d[c]),o.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)}},{key:"outputDataUpdate",value:function(){var a=o.time;null!==a&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(a,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))}}]),a}(),v=function(){function a(b,c,d){e(this,a),this.field=b||1,this.outputs=[c,d],this.channels=[new u(1,c),new u(2,d)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,"char":0,cmd:0,other:0}}return d(a,[{key:"getHandler",value:function(a){return this.channels[a].getHandler()}},{key:"setHandler",value:function(a,b){this.channels[a].setHandler(b)}},{key:"addData",value:function(a,b){var c,d,e,g,h,f=!1;for(this.lastTime=a,o.setTime(a),g=0;g<b.length;g+=2)d=127&b[g],e=127&b[g+1],0!==d||0!==e?(o.log("DATA","["+p([b[g],b[g+1]])+"] -> ("+p([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),c||(f=this.parseChars(d,e),f&&(this.currChNr&&this.currChNr>=0?(h=this.channels[this.currChNr-1],h.insertChars(f)):o.log("WARNING","No channel found yet. TEXT-MODE?"))),c?this.dataCounters.cmd+=2:f?this.dataCounters.char+=2:(this.dataCounters.other+=2,o.log("WARNING","Couldn't parse cleaned data "+p([d,e])+" orig: "+p([b[g],b[g+1]])))):this.dataCounters.padding+=2}},{key:"parseCmd",value:function(a,b){var f,c=null,d=(20===a||28===a)&&b>=32&&47>=b,e=(23===a||31===a)&&b>=33&&35>=b;return d||e?a===this.lastCmdA&&b===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,o.log("DEBUG","Repeated command ("+p([a,b])+") is dropped"),!0):(c=20===a||23===a?1:2,f=this.channels[c-1],20===a||28===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0):!1}},{key:"parseMidrow",value:function(a,b){var d,c=null;return(17===a||25===a)&&b>=32&&47>=b?(c=17===a?1:2,c!==this.currChNr?(o.log("ERROR","Mismatch channel in midrow parsing"),!1):(d=this.channels[c-1],d.ccMIDROW(b),o.log("DEBUG","MIDROW ("+p([a,b])+")"),!0)):!1}},{key:"parsePAC",value:function(a,b){var g,h,c=null,d=null,e=(a>=17&&23>=a||a>=25&&31>=a)&&b>=64&&127>=b,f=(16===a||24===a)&&b>=64&&95>=b;return e||f?a===this.lastCmdA&&b===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,!0):(c=23>=a?1:2,d=b>=64&&95>=b?1===c?j[a]:l[a]:1===c?k[a]:m[a],g=this.interpretPAC(d,b),h=this.channels[c-1],h.setPAC(g),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0):!1}},{key:"interpretPAC",value:function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1===(1&c),13>=c?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:15>=c?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d}},{key:"parseChars",value:function(a,b){var f,h,c=null,d=null,e=null;return a>=25?(c=2,e=a-8):(c=1,e=a),e>=17&&19>=e?(f=b,f=17===e?b+80:18===e?b+112:b+144,o.log("INFO","Special char '"+g(f)+"' in channel "+c),d=[f]):a>=32&&127>=a&&(d=0===b?[a]:[a,b]),d&&(h=p(d),o.log("DEBUG","Char codes =  "+h.join(",")),this.lastCmdA=null,this.lastCmdB=null),d}},{key:"parseBackgroundAttributes",value:function(a,b){var c,d,e,f,g=(16===a||24===a)&&b>=32&&47>=b,h=(23===a||31===a)&&b>=45&&47>=b;return g||h?(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=n[d],1===b%2&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=24>a?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0):!1}},{key:"reset",value:function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)}}]),a}(),c.default=v},{}],50:[function(a,b){"use strict";var d=a(57),e={newCue:function(a,b,c,e){var f,g,h,i,j,l,m,k=window.VTTCue||window.TextTrackCue;for(l=0;l<e.rows.length;l++)if(f=e.rows[l],h=!0,i=0,j="",!f.isEmpty()){for(m=0;m<f.chars.length;m++)f.chars[m].uchar.match(/\s/)&&h?i++:(j+=f.chars[m].uchar,h=!1);f.cueStartTime=b,b===c&&(c+=1e-4),g=new k(b,c,d.fixLineBreaks(j.trim())),i>=16?i--:i++,g.line=navigator.userAgent.match(/Firefox\//)?l+1:l>7?l-2:l+1,g.align="left",g.position=Math.max(0,Math.min(100,100*(i/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),a.addCue(g)}}};b.exports=e},{57:57}],51:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{"default":a}}function g(a,b){return e.default.search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})}var d,e;Object.defineProperty(c,"__esModule",{value:!0}),c.findFragWithCC=g,d=a(48),e=f(d)},{48:48}],52:[function(a,b,c){"use strict";function g(a){return a&&a.__esModule?a:{"default":a}}function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,i;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(53),f=g(e),i=function(){function a(b,c,d,e){h(this,a),this.hls=b,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new f.default(c),this.fast_=new f.default(d)}return d(a,[{key:"sample",value:function(a,b){a=Math.max(a,this.minDelayMs_);var c=8e3*b/a,d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)}},{key:"canEstimate",value:function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),a}(),c.default=i},{53:53}],53:[function(a,b,c){"use strict";function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,f;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){e(this,a),this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=0,this.totalWeight_=0}return d(a,[{key:"sample",value:function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_}}]),a}(),c.default=f},{}],54:[function(a,b,c){"use strict";function e(){}function h(a,b){return b="["+a+"] > "+b}function i(a){var b=self.console[a];return b?function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];d[0]&&(d[0]=h(a,d[0])),b.apply(self.console,d)}:e}function j(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];c.forEach(function(b){g[b]=a[b]?a[b].bind(a):i(b)})}var d,f,g;Object.defineProperty(c,"__esModule",{value:!0}),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},f={trace:e,debug:e,log:e,warn:e,info:e,error:e},g=f,c.enableLogs=function(a){if(a===!0||"object"===("undefined"==typeof a?"undefined":d(a))){j(a,"debug","log","info","warn","error");try{g.log()}catch(b){g=f}}else g=f},c.logger=g},{}],55:[function(a,b){"use strict";var d={toString:function(a){var d,b="",c=a.length;for(d=0;c>d;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}};b.exports=d},{}],56:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=function(){function d(a){if("string"!=typeof a)return!1;var c=b[a.toLowerCase()];return c?a.toLowerCase():!1}function e(a){if("string"!=typeof a)return!1;var b=c[a.toLowerCase()];return b?a.toLowerCase():!1}function f(a){for(var c,d,b=1;b<arguments.length;b++){c=arguments[b];for(d in c)a[d]=c[d]}return a}function g(b,c,g){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,h=this,i=function(){return"undefined"!=typeof navigator?/MSIE\s8\.0/.test(navigator.userAgent):void 0}(),j={};return i?h=document.createElement("custom"):j.enumerable=!0,h.hasBeenReset=!1,k="",l=!1,m=b,n=c,o=g,p=null,q="",r=!0,s="auto",t="start",u=50,v="middle",w=50,x="middle",Object.defineProperty(h,"id",f({},j,{get:function(){return k},set:function(a){k=""+a}})),Object.defineProperty(h,"pauseOnExit",f({},j,{get:function(){return l},set:function(a){l=!!a}})),Object.defineProperty(h,"startTime",f({},j,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",f({},j,{get:function(){return n},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");n=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",f({},j,{get:function(){return o},set:function(a){o=""+a,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",f({},j,{get:function(){return p},set:function(a){p=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",f({},j,{get:function(){return q},set:function(a){var b=d(a);if(b===!1)throw new SyntaxError("An invalid or illegal string was specified.");q=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",f({},j,{get:function(){return r},set:function(a){r=!!a,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",f({},j,{get:function(){return s},set:function(b){if("number"!=typeof b&&b!==a)throw new SyntaxError("An invalid number or illegal string was specified.");s=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",f({},j,{get:function(){return t},set:function(a){var b=e(a);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");t=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",f({},j,{get:function(){return u},set:function(a){if(0>a||a>100)throw new Error("Position must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",f({},j,{get:function(){return v},set:function(a){var b=e(a);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");v=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",f({},j,{get:function(){return w},set:function(a){if(0>a||a>100)throw new Error("Size must be between 0 and 100.");w=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",f({},j,{get:function(){return x},set:function(a){var b=e(a);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");x=b,this.hasBeenReset=!0}})),h.displayState=void 0,i?h:void 0}var a,b,c;return"undefined"!=typeof window&&window.VTTCue?window.VTTCue:(a="auto",b={"":!0,lr:!0,rl:!0},c={start:!0,middle:!0,end:!0,left:!0,right:!0},g.prototype.getCueAsHTML=function(){var a=window.WebVTT;return a.convertCueToDOMTree(window,this.text)},g)}()},{}],57:[function(a,b,c){"use strict";function f(a){return a&&a.__esModule?a:{"default":a}}function h(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new g,this.regionList=[]}function i(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+(0|d)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return c?c[3]?b(c[1],c[2],c[3].replace(":",""),c[4]):c[1]>59?b(c[1],c[2],0,c[4]):b(0,c[1],c[2],c[4]):null}function j(){this.values=Object.create(null)}function k(a,b,c,d){var f,g,h,i,e=d?a.split(d):[a];for(f in e)"string"==typeof e[f]&&(g=e[f].split(c),2===g.length&&(h=g[0],i=g[1],b(h,i)))}function n(a,b,c){function e(){var b=i(a);if(null===b)throw new Error("Malformed timestamp: "+d);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function f(a,b){var e,f,d=new j;k(a,function(a,b){var e,f,g;switch(a){case"region":for(e=c.length-1;e>=0;e--)if(c[e].id===b){d.set(a,c[e].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":f=b.split(","),g=f[0],d.integer(a,g),d.percent(a,g)&&d.set("snapToLines",!1),d.alt(a,g,["auto"]),2===f.length&&d.alt("lineAlign",f[1],["start",m,"end"]);
break;case"position":f=b.split(","),d.percent(a,f[0]),2===f.length&&d.alt("positionAlign",f[1],["start",m,"end","line-left","line-right","auto"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",m,"end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical",""),e=d.get("line","auto"),"auto"===e&&-1===l.line&&(e=-1),b.line=e,b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align",m),f=d.get("position","auto"),"auto"===f&&50===l.position&&(f="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50),b.position=f}function g(){a=a.replace(/^\s+/,"")}var d=a;if(g(),b.startTime=e(),g(),"-->"!==a.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+d);a=a.substr(3),g(),b.endTime=e(),g(),f(a,b)}function o(a){return a.replace(/<br(?: \/)?>/gi,"\n")}var d,e,g,l,m;Object.defineProperty(c,"__esModule",{value:!0}),c.fixLineBreaks=void 0,d=a(56),e=f(d),g=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}},j.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){var c;return(c=b.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(b=parseFloat(b),b>=0&&100>=b)?(this.set(a,b),!0):!1}},l=new e.default(0,0,0),m="middle"===l.align?"middle":"center",h.prototype={parse:function(a){function c(){var d,a=b.buffer,c=0;for(a=o(a);c<a.length&&"\r"!==a[c]&&"\n"!==a[c];)++c;return d=a.substr(0,c),"\r"===a[c]&&++c,"\n"===a[c]&&++c,b.buffer=a.substr(c),d}function d(a){k(a,function(a,b){switch(a){case"Region":console.log("parse region",b)}},/:/)}var f,g,h,j,b=this;a&&(b.buffer+=b.decoder.decode(a,{stream:!0}));try{if("INITIAL"===b.state){if(!/\r\n|\n/.test(b.buffer))return this;if(f=c(),g=f.match(/^WEBVTT([ \t].*)?$/),!g||!g[0])throw new Error("Malformed WebVTT signature.");b.state="HEADER"}for(h=!1;b.buffer;){if(!/\r\n|\n/.test(b.buffer))return this;switch(h?h=!1:f=c(),b.state){case"HEADER":/:/.test(f)?d(f):f||(b.state="ID");continue;case"NOTE":f||(b.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){b.state="NOTE";break}if(!f)continue;if(b.cue=new e.default(0,0,""),b.state="CUE",-1===f.indexOf("-->")){b.cue.id=f;continue}case"CUE":try{n(f,b.cue,b.regionList)}catch(i){b.cue=null,b.state="BADCUE";continue}b.state="CUETEXT";continue;case"CUETEXT":if(j=-1!==f.indexOf("-->"),!f||j&&(h=!0)){b.oncue&&b.oncue(b.cue),b.cue=null,b.state="ID";continue}b.cue.text&&(b.cue.text+="\n"),b.cue.text+=f;continue;case"BADCUE":f||(b.state="ID");continue}}}catch(i){"CUETEXT"===b.state&&b.cue&&b.oncue&&b.oncue(b.cue),b.cue=null,b.state="INITIAL"===b.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var a=this;try{if(a.buffer+=a.decoder.decode(),(a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state)throw new Error("Malformed WebVTT signature.")}catch(b){throw b}return a.onflush&&a.onflush(),this}},c.fixLineBreaks=o,c.default=h},{56:56}],58:[function(a,b){"use strict";function f(a){return a&&a.__esModule?a:{"default":a}}var d=a(57),e=f(d),g=function(a,b,c){return a.substr(c||0,b.length)===b},h=function(a){var b=parseInt(a.substr(-3)),c=parseInt(a.substr(-6,2)),d=parseInt(a.substr(-9,2)),e=a.length>9?parseInt(a.substr(0,a.indexOf(":"))):0;return isNaN(b)||isNaN(c)||isNaN(d)||isNaN(e)?-1:(b+=1e3*c,b+=6e4*d,b+=36e5*e)},i=function n(a){for(var n=5381,b=a.length;b;)n=33*n^a.charCodeAt(--b);return(n>>>0).toString()},j=function(a,b,c){var d=a[b],e=a[d.prevCC];if(!e||!e.new&&d.new)return a.ccOffset=a.presentationOffset=d.start,d.new=!1,void 0;for(;e&&e.new;)a.ccOffset+=d.start-e.start,d.new=!1,d=e,e=a[d.prevCC];a.presentationOffset=c},k={parse:function(a,b,c,d,f,k){var l=/\r\n|\n\r|\n|\r/g,m=String.fromCharCode.apply(null,new Uint8Array(a)).trim().replace(l,"\n").split("\n"),n="00:00.000",o=0,p=0,q=0,r=[],s=void 0,t=!0,u=new e.default;u.oncue=function(a){var b=c[d],e=c.ccOffset;b&&b.new&&(void 0!==p?e=c.ccOffset=b.start:j(c,d,q)),q&&(e=q+c.ccOffset-c.presentationOffset),a.startTime+=e-p,a.endTime+=e-p,a.id=i(a.startTime)+i(a.endTime)+i(a.text),a.text=decodeURIComponent(escape(a.text)),a.endTime>0&&r.push(a)},u.onparsingerror=function(a){s=a},u.onflush=function(){return s&&k?(k(s),void 0):(f(r),void 0)},m.forEach(function(a){if(t){if(g(a,"X-TIMESTAMP-MAP=")){t=!1,a.substr(16).split(",").forEach(function(a){g(a,"LOCAL:")?n=a.substr(6):g(a,"MPEGTS:")&&(o=parseInt(a.substr(7)))});try{b=0>b?b+8589934592:b,o-=b,p=h(n)/1e3,q=o/9e4,-1===p&&(s=new Error("Malformed X-TIMESTAMP-MAP: "+a))}catch(c){s=new Error("Malformed X-TIMESTAMP-MAP: "+a)}return}""===a&&(t=!1)}u.parse(a+"\n")}),u.flush()}};b.exports=k},{57:57}],59:[function(a,b,c){"use strict";function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,g;Object.defineProperty(c,"__esModule",{value:!0}),d=function(){function a(a,b){var c,d;for(c=0;c<b.length;c++)d=b[c],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=a(54),g=function(){function a(b){f(this,a),this._config=b,b&&b.xhrSetup&&(this.xhrSetup=b.xhrSetup)}return d(a,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:performance.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var a,c,d,b=this.context;a=this.loader="undefined"!=typeof XDomainRequest?new XDomainRequest:new XMLHttpRequest,c=this.stats,c.tfirst=0,c.loaded=0,d=this.xhrSetup,b.url=b.url.replace(/http(|s):\/\//,"//");try{if(d)try{d(a,b.url)}catch(e){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0)}catch(e){return this.callbacks.onError({code:a.status,text:e.message},b,a),void 0}b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()}},{key:"readystatechange",value:function(a){var i,j,k,l,b=a.currentTarget,c=b.readyState,d=this.stats,f=this.context,g=this.config;try{this._config.readystatechange&&this._config.readystatechange(a)}catch(h){}d.aborted||c>=2&&(window.clearTimeout(this.requestTimeout),0===d.tfirst&&(d.tfirst=Math.max(performance.now(),d.trequest)),4===c?(i=b.status,i>=200&&300>i?(d.tload=Math.max(d.tfirst,performance.now()),j=void 0,k=void 0,"arraybuffer"===f.responseType?(j=b.response,k=j.byteLength):(j=b.responseText,j=j.replace(/http(|s):\/\//g,"https://"),k=j.length),d.loaded=d.total=k,l={url:b.responseURL,data:j},this.callbacks.onSuccess(l,d,f,b)):d.retry>=g.maxRetry||i>=400&&499>i?(e.logger.error(i+" while loading "+f.url),this.callbacks.onError({code:i,text:b.statusText},f,b)):(e.logger.warn(i+" while loading "+f.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,g.maxRetryDelay),d.retry++)):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),g.timeout))}},{key:"loadtimeout",value:function(){e.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)}},{key:"loadprogress",value:function(a){var d,b=a.currentTarget,c=this.stats;c.loaded=a.loaded,a.lengthComputable&&(c.total=a.total),d=this.callbacks.onProgress,d&&d(c,this.context,null,b)}}]),a}(),c.default=g},{54:54}]},{},[40])(40)});